API æ–‡æ¡£

[](https://quant.10jqka.com.cn/)
- é¦–é¡µæˆ‘çš„ç­–ç•¥ç­–ç•¥åˆ›ä½œç­–ç•¥ç ”ç©¶æŒ‡æ ‡ç­–ç•¥ç­–ç•¥ç›‘æ§ç­–ç•¥åº“å› å­ç ”ç©¶å› å­ç­–ç•¥å› å­æ£€æµ‹å› å­åº“ç»©æ•ˆåˆ†ææˆ‘çš„ç ”ç©¶å®ç›˜äº¤æ˜“pythonç­–ç•¥æ¨¡æ‹ŸæŒ‡æ ‡ç­–ç•¥æ¨¡æ‹ŸåŒèŠ±é¡ºæ™ºèƒ½äº¤æ˜“ç¤¾åŒºå¸®åŠ©æœ¬åœ°SDKAPI æ–‡æ¡£å› å­ç ”ç©¶æ¨¡æ‹Ÿä»¿çœŸå›æµ‹å¼•æ“ç ”ç©¶ç¯å¢ƒ/å®ç›˜å¸¸è§é—®é¢˜å› å­æ•°æ®äº§å“æ™ºèƒ½äº¤æ˜“åœ¨çº¿æ–‡æ¡£æ•°æ®
 å…¨å±€æœç´¢ [ç™»å½•](javascript:void(0))[æ³¨å†Œ](https://upass.10jqka.com.cn/register)API æ–‡æ¡£
- å›æµ‹å¼•æ“ä¸“ç”¨API[é‡è¦ï¼ï¼]å†™åœ¨æœ€å‰é¢åŸºæœ¬å‡½æ•°initäº¤æ˜“é¢‘ç‡è‡ªåŠ¨è°ƒç”¨å‡½æ•°å…¥å£ handle_bartickè¡Œæƒ…æ•°æ®å˜åŒ–æ—¶è°ƒç”¨ handle_tické›†åˆç«ä»·å(9:26)è°ƒç”¨ä¸€æ¬¡ï¼šopen_auctionå¼€ç›˜å‰åŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ï¼šbefore_tradingå½“å¤©æ”¶ç›˜ååŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ï¼šafter_tradingå§”æ‰˜çŠ¶æ€æ›´æ–°åçš„å›è°ƒå‡½æ•°ï¼šon_orderæœ‰æˆäº¤åçš„å›è°ƒå‡½æ•°ï¼šon_tradeè‡ªå®šä¹‰è¿è¡Œå‡½æ•°è®¾ç½®å‡½æ•°æ•°æ®å‡½æ•°äº¤æ˜“å‡½æ•°æšä¸¾å¸¸é‡é‡è¦å¯¹è±¡è¾…åŠ©å‡½æ•°å·¥å…·å‡½æ•°è‚¡ç¥¨ä»£ç æ ¼å¼è½¬æ¢ï¼šnormalize_symbolä¿å­˜æ–‡ä»¶å‡½æ•°ï¼šwrite_fileè¯»å–æ–‡ä»¶å‡½æ•°ï¼šread_fileæŸ¥è¯¢ç ”ç©¶ç¯å¢ƒæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼šlist_fileå¤åˆ¶/å‰ªè´´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼šcopy_fileåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼šremove_fileæ¶ˆæ¯æ¨é€å‡½æ•°ï¼šnotify_pushè‡ªé€‰æ¿å—ï¼šcustom_sectoré€šç”¨æ•°æ®æ¥å£è¡Œæƒ…èµ„é‡‘æ•°æ®è¯åˆ¸ä¿¡æ¯æ•°æ®è¡¨æ•°æ®é—®è´¢æ¥å£é—®è´¢æ¥å£ä½¿ç”¨å‰å¿…è¯»é—®è´¢å®æ—¶æ•°æ®ï¼šquery_iwencai (ç ”ç©¶ç¯å¢ƒä½¿ç”¨ï¼Œä¸ç½‘é¡µä½¿ç”¨ä¸€è‡´)é—®è´¢æ˜¨æ—¥æ•°æ®ï¼šget_iwencai(å›æµ‹ç¯å¢ƒä½¿ç”¨)é—®è´¢æ¥å£æ˜¯å¦æ”¯æŒæœ¬åœ°æ¥å£è°ƒç”¨ï¼Ÿå¸‚é¢ZUIå…¨ï¼ä¸€æ–‡è®²é€é—®è´¢è¯­å¥æ·±åº¦ä½¿ç”¨æŠ€å·§ï¼ˆå«50ä¸ªæ¡ˆä¾‹ï¼‰ç»„åˆä¼˜åŒ–å™¨æ„é€ ç»„åˆä¼˜åŒ–å®˜æ–¹äº¤æµç¾¤æ³¨æ„æ­¤ç¾¤ä¸ºäº¤æµç¾¤ï¼Œå¦‚æœæœ‰ç–‘é—®è¯·åœ¨è®ºå›å‘å¸– ï¼Œç‚¹æ­¤å‘å¸–

# APIæ–‡æ¡£

å¦‚æœæ‚¨æœ‰ä»»ä½•æ„è§å»ºè®®æˆ–è€…æ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°è¯´æ˜æ–‡æ¡£ä¸­æ— æ³•è§£ç­”çš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥:

- ğŸ“¢åœ¨SuperMindå®˜æ–¹ç¤¾åŒºå‘å¸–æé—®äº¤æµ

- ğŸ’Œç»™æˆ‘ä»¬å‘é€é‚®ä»¶ï¼š SuperMind@myhexin.com

- æ–°æ–‡æ¡£è¿˜åœ¨ä¸æ–­å®Œå–„ä¸­ï¼Œæƒ³æš‚æ—¶ä½¿ç”¨æ—§çš„ç‰ˆæœ¬å¯ä»¥æŸ¥çœ‹ï¼šæ—§çš„æ–‡æ¡£

## å›æµ‹å¼•æ“ä¸“ç”¨API

ç›®å‰ï¼ŒSuperMindç­–ç•¥APIè·Ÿæ®æ ‡çš„ã€å›æµ‹æ¨¡å¼ä¸åŒåˆ†ä¸ºä¸ƒç§ç±»å‹ï¼š

- è‚¡ç¥¨APIï¼šç”¨äºè‚¡ç¥¨ã€åœºå†…åŸºé‡‘ã€å¯è½¬å€ºç­–ç•¥å›æµ‹

- è‚¡ç¥¨æ—¥å†…APIï¼šç”¨äºè‚¡ç¥¨æ—¥å†…å›è½¬äº¤æ˜“ç­–ç•¥å›æµ‹

- æœŸè´§æœŸæƒAPIï¼šç”¨äºæœŸè´§æœŸæƒç­–ç•¥å›æµ‹

- è‚¡ç¥¨æœŸè´§APIï¼šç”¨æˆ·è‚¡ç¥¨å’ŒæœŸè´§å¯¹å†²ç­–ç•¥çš„å›æµ‹

- åœºå¤–åŸºé‡‘APIï¼šç”¨äºåœºå¤–åŸºé‡‘ç”³èµç­–ç•¥å›æµ‹

- å¤–æ±‡APIï¼šç”¨äºå›æµ‹å¤–æ±‡åˆçº¦ç­–ç•¥

- T+Dåˆçº¦APIï¼šç”¨äºå›æµ‹å»¶æœŸäº¤æ”¶åˆçº¦ç­–ç•¥

### [é‡è¦ï¼ï¼]å†™åœ¨æœ€å‰é¢

è‹¥å‡ºç°'****'æœªå®šä¹‰çš„æƒ…å†µï¼Œè¯·å…ˆå¼•å…¥åŒ…ï¼Œå»ºè®®é»˜è®¤éƒ½åŠ ä¸Šï¼Œæ›´æ–¹ä¾¿ï¼š

```
from mindgo_api import *
â€‹
```

### åŸºæœ¬å‡½æ•°

| function | è‚¡ç¥¨ | è‚¡ç¥¨æ—¥å†… | æœŸè´§æœŸæƒ | è‚¡ç¥¨æœŸè´§ | åœºå¤–åŸºé‡‘ | å¤–æ±‡ | T+Dåˆçº¦ |
| --- | --- | --- | --- | --- | --- | --- | --- |
| init | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| handle_bar | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| handle_tick | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| open_auction | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| before_trading | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| after_trading | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| on_order | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| on_trade | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |

- â—æ³¨æ„äº‹é¡¹ï¼š

è‚¡ç¥¨ç­–ç•¥ç›®å‰ä»…åœ¨ç ”ç©¶ç¯å¢ƒçš„å›æµ‹æ¥å£ä¸­æ”¯æŒ handle_tick
handle_tickä¸ handle_barä¸èƒ½å¹¶å­˜

#### init

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def init(context):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

åˆå§‹åŒ–å‡½æ•°ï¼Œè¿›è¡Œç­–ç•¥å›æµ‹ä¸æ¨¡æ‹Ÿäº¤æ˜“æ—¶åœ¨æœ€å¼€å§‹æ—¶æ‰§è¡Œä¸€æ¬¡ initï¼Œä»¿çœŸäº¤æ˜“åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œç­–ç•¥æ—¶æ‰§è¡Œä¸€æ¬¡ init
ğŸ‘€ï¸ ç‰¹åˆ«è¯´æ˜:

ä»…åœ¨ç­–ç•¥ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ‰§è¡Œ

åœ¨ç ”ç©¶ç¯å¢ƒä¸­,ä½¿ç”¨ research_tradeæ¥å£æ‰§è¡Œç­–ç•¥æ—¶,ç¬¬ä¸€æ¬¡è¿è¡Œä¼šåœ¨'./persist'è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªç­–ç•¥åŒå(ç”¨æˆ·å¯è‡ªå®šä¹‰ä¼ å…¥ research_tradeæ¥å£)æ–‡ä»¶å¤¹,ç”¨äºæŒä¹…åŒ–å…¨å±€å˜é‡ã€‚

æ‰§è¡Œæ­¤ç­–ç•¥æ—¶,å¦‚æœ'./persist'ä¸‹å­˜åœ¨åŒåè·¯å¾„,åˆ™ä¸ä¼šæ‰§è¡Œinit

å¦‚æœè¦é‡æ–°æ‰§è¡Œinit

1ã€åˆ é™¤ './persist'ä¸‹å­˜åœ¨çš„åŒåè·¯å¾„ï¼›ï¼ˆåŠ å…¥å›æ”¶ç«™ï¼Œå†æ¸…ç©ºå›æ”¶ç«™ï¼‰

2ã€æˆ–è€…æ›´æ”¹research_tradeå‡½æ•°ä¸­çš„ç­–ç•¥åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

rtrade = research_trade(
    'è¦è®©inité‡æ–°æ‰§è¡Œï¼Œè¯·æ›´æ”¹è¿™ä¸ªç­–ç•¥åç§°',
     source_code,
     frequency='MINUTE', 
     trade_api=trade_api,
     signal_mode=False,
     recover_dt='today'
)
â€‹

å¸¸è§çš„æŠ¥é”™ï¼š

å› ä¸ºå†initæ‰§è¡Œè¿‡åï¼Œæ·»åŠ äº†ä¿¡æ¯ï¼Œæ‰€ä»¥ç¨‹åºæ— æ³•è¯†åˆ«ã€‚ç”¨ä¸Šè¿°æ–¹æ³•è¿›è¡Œä¿®å¤ã€‚GlobalVars' object has no attribute '****'

ç”¨äºåˆå§‹åŒ–è´¦æˆ·ä¿¡æ¯ã€å›æµ‹å‚æ•°ã€å…¨å±€å˜é‡ç­‰

â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ç”¨äºåˆå§‹åŒ–è´¦æˆ·,ä»»ä½•ä¸€ä¸ªç­–ç•¥éƒ½å¿…é¡»æœ‰è¯¥å‡½æ•°
åœ¨è¯¥å‡½æ•°ä¸‹,ä½ å¯ä»¥è®¾ç½®å¾ˆå¤šåˆå§‹æ¡ä»¶,ä¾‹å¦‚ï¼šåŸºå‡†,äº¤æ˜“è´¹,æ»‘ç‚¹,åˆçº¦æ± ç­‰ç­‰

ğŸ“ç¤ºä¾‹ï¼š

from mindgo_api import *

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„æ ‡çš„(å¹³å®‰é“¶è¡Œ) ,å‘½åçš„æ—¶å€™æ³¨æ„ä¸è¦è¦†ç›–ç³»ç»Ÿå˜é‡
    context.stock = '000001.SZ'
â€‹

#### äº¤æ˜“é¢‘ç‡è‡ªåŠ¨è°ƒç”¨å‡½æ•°å…¥å£ handle_bar

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def handle_bar(context,bar_dict):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |
| bar_dict | bar_dictå¯¹è±¡ | ç”¨äºå­˜æ”¾å½“å‰è®¢é˜…æ‰€æœ‰åˆçº¦çš„barè¡Œæƒ…æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

å‡½æ•°ç”¨æ¥å®šæ—¶æ‰§è¡Œä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ handle_bar

- â—æ³¨æ„äº‹é¡¹ï¼š

å°½å¯èƒ½ä¿è¯æ­¤å‡½æ•°ä¸­çš„ä»£ç æ•ˆç‡ï¼Œé¿å…åœ¨æ­¤å‡½æ•°ä¸‹æŸ¥è¯¢å¤§é‡æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡æ‹Ÿã€ä»¿çœŸäº¤æ˜“ä¸­ï¼Œé¿å…å‡ºç°æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´äº§ç”Ÿå»¶æ—¶æˆæœ¬
æ­¤å‡½æ•°åœ¨éäº¤æ˜“æ—¶é—´ä¸ä¼šè§¦å‘(ä¾‹å¦‚1æœˆ1æ—¥è‡³3æ—¥æ˜¯éäº¤æ˜“æ—¥ï¼Œåˆ™handle_baråœ¨1æ—¥è‡³3æ—¥ä¸è§¦å‘ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªäº¤æ˜“æ—¥4å·è§¦å‘)
æ­¤å‡½æ•°çš„è°ƒç”¨é¢‘ç‡æ ¹æ®ç­–ç•¥çš„äº¤æ˜“é¢‘ç‡ç¡®å®š
åœ¨è¯¥å‡½æ•°ä¸­ï¼Œå¯ä»¥ä¼ å…¥å…¶ä»–å‡½æ•°çš„è¿è¡Œç»“æœï¼Œç”¨æ¥åˆ¤æ–­ä¹°å–æ¡ä»¶

- ğŸ“ç¤ºä¾‹ï¼š

```
# æ¯ä¸ªäº¤æ˜“é¢‘ç‡ä¹°å…¥100è‚¡å¹³å®‰é“¶è¡Œ
def handle_bar(context, bar_dict):
    order('000001.SZ', 100)
â€‹
```

#### tickè¡Œæƒ…æ•°æ®å˜åŒ–æ—¶è°ƒç”¨ handle_tick

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def handle_tick(context,tick):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |
| tick | tickå¯¹è±¡ | ç”¨äºå­˜æ”¾å½“å‰æ¨é€åˆçº¦çš„tickè¡Œæƒ…æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

å½“æ‰€è®¢é˜…çš„è‚¡ç¥¨tickè¡Œæƒ…æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡ handle_tickå‡½æ•°

- â—æ³¨æ„äº‹é¡¹ï¼š

å°½å¯èƒ½ä¿è¯æ­¤å‡½æ•°ä¸­çš„ä»£ç æ•ˆç‡ï¼Œé¿å…åœ¨æ­¤å‡½æ•°ä¸‹æŸ¥è¯¢å¤§é‡æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡æ‹Ÿã€ä»¿çœŸäº¤æ˜“ä¸­ï¼Œé¿å…å‡ºç°æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´äº§ç”Ÿå»¶æ—¶æˆæœ¬
å½“åŒæ—¶è®¢é˜…äº†å¤šåªè‚¡ç¥¨æ—¶ï¼Œéµå¾ªâ€œæ—¶é—´ä¼˜å…ˆï¼Œé¡ºåºä¼˜å…ˆâ€çš„è§„åˆ™ï¼Œå³é¦–å…ˆæ‰§è¡Œæ—¶é—´æˆ³é å‰çš„è‚¡ç¥¨ï¼Œå¦‚æœæ—¶é—´æˆ³ä¸€åªï¼Œåˆ™æŒ‰ç…§è®¢é˜…åˆ—è¡¨ä¸­çš„é¡ºåºæ‰§è¡Œ
tickè¡Œæƒ…çš„æ›´æ–°ä¼šè‡ªåŠ¨è§¦å‘è¯¥æ–¹æ³•çš„è°ƒç”¨ã€‚ç­–ç•¥å…·ä½“é€»è¾‘å¯åœ¨è¯¥æ–¹æ³•å†…å®ç°ï¼ŒåŒ…æ‹¬äº¤æ˜“ä¿¡å·çš„äº§ç”Ÿã€è®¢å•çš„åˆ›å»ºç­‰ã€‚åœ¨å®æ—¶æ¨¡æ‹Ÿäº¤æ˜“ä¸­ï¼Œè¯¥å‡½æ•°æœ‰tickè¡Œæƒ…åˆ™è¢«è§¦å‘ä¸€æ¬¡
ä»…åœ¨T0ç­–ç•¥ã€è‚¡ç¥¨ç­–ç•¥(ç ”ç©¶ç¯å¢ƒ)ä¸­æœ‰æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

```
# æ‰“å°å½“å‰æ¨é€tickè¡Œæƒ…çš„è‚¡ç¥¨ä»£ç ï¼Œå¹¶ä¸‹å•ä¹°å…¥100è‚¡
def handle_tick(context, tick):
    log.info(tick.order_book_id)
    order(tick.order_book_id, 100)
â€‹
```

#### é›†åˆç«ä»·å(9:26)è°ƒç”¨ä¸€æ¬¡ï¼šopen_auction

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def open_auction(context,bar_dict):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |
| bar_dict | bar_dictå¯¹è±¡ | ç”¨äºå­˜æ”¾å½“å‰è®¢é˜…æ‰€æœ‰åˆçº¦çš„barè¡Œæƒ…æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

é›†åˆç«ä»·å(9:26)ï¼Œè°ƒç”¨ä¸€æ¬¡ open_auctionå‡½æ•°

- â—æ³¨æ„äº‹é¡¹ï¼š

å°½å¯èƒ½ä¿è¯æ­¤å‡½æ•°ä¸­çš„ä»£ç æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡æ‹Ÿã€ä»¿çœŸäº¤æ˜“ä¸­ï¼Œé¿å…å‡ºç°æ‰§è¡Œæ—¶é—´è¿‡é•¿
åœ¨å›æµ‹ã€æ¨¡æ‹Ÿäº¤æ˜“ä¸­ï¼Œåœ¨æ­¤é˜¶æ®µä¸‹å•ä¼šä½¿ç”¨é›†åˆç«ä»·æˆäº¤æ•°æ®å¯¹è®¢å•è¿›è¡Œæ’®åˆï¼Œå¯ç”¨äºå›æµ‹é›†åˆç«ä»·ç­–ç•¥ï¼›ä½†åœ¨ä»¿çœŸäº¤æ˜“ä¸­ï¼Œæ­¤æ—¶ä¸‹çš„è®¢å•ä¼šåœ¨9:30è¿›è¡Œæ’®åˆ
ä»…åœ¨è‚¡ç¥¨ç­–ç•¥ä¸­æœ‰æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

```
# ä¸‹å•ä¹°å…¥100è‚¡å¹³å®‰é“¶è¡Œ
def open_auction(context, bar_dict):
    order('000001.SZ', 100)
â€‹
```

#### å¼€ç›˜å‰åŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ï¼šbefore_trading

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def before_trading(context):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

å½“å¤©å¼€ç›˜å‰åŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ before_tradingï¼Œå¸¸ç”¨äºä½¿ç”¨å‰æ—¥æ•°æ®è®¡ç®—å› å­ã€ä¿¡å·ï¼›å‚¨å­˜è‡ªå®šä¹‰å‚æ•°ã€å…¨å±€å˜é‡ç­‰

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åœ¨å›æµ‹ä¸­çš„éäº¤æ˜“æ—¥ä¸è§¦å‘
åœ¨è¯¥å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥è‡ªç”±å‚¨å­˜è‡ªå®šä¹‰å‡½æ•°çš„è¿è¡Œç»“æœã€å…¨å±€å˜é‡æ•°æ®ç­‰,å¹¶åœ¨ handle_barç­‰å‡½æ•°ä¸­ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
# æ¯ä¸ªäº¤æ˜“æ—¥å¼€å¸‚å‰ï¼Œæ‰“å°å‡ºç›®å‰çš„è´¦æˆ·ä¿¡æ¯.
def before_trading(context):
    log.info(context.portfolio)
â€‹
```

#### å½“å¤©æ”¶ç›˜ååŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ï¼šafter_trading

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def after_trading(context):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |

- ğŸ”§ä½œç”¨ï¼š

å½“å¤©æ”¶ç›˜ååŠå°æ—¶è°ƒç”¨ä¸€æ¬¡ after_tradingï¼Œå¸¸ç”¨äºè·Ÿæ®å‰æ—¥æ•°æ®è®¡ç®—ï¼›å‚¨å­˜è‡ªå®šä¹‰å‚æ•°ã€å…¨å±€å˜é‡ç­‰

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åœ¨å›æµ‹ä¸­çš„éäº¤æ˜“æ—¥ä¸è§¦å‘
åœ¨è¯¥å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥è‡ªç”±å‚¨å­˜è‡ªå®šä¹‰å‡½æ•°çš„è¿è¡Œç»“æœã€å…¨å±€å˜é‡æ•°æ®ç­‰ï¼Œç”¨æ¥æ€»ç»“ä»Šæ—¥çš„äº¤æ˜“ï¼Œå¹¶è®¡åˆ’æ˜å¤©çš„äº¤æ˜“

- ğŸ“ç¤ºä¾‹ï¼š

```
#äº¤æ˜“æ—¥ç»“æŸåï¼Œæ‰“å°ç»„åˆç›ˆäº
def after_trading(context):
    log.info(context.portfolio.pnl)
â€‹
```

#### å§”æ‰˜çŠ¶æ€æ›´æ–°åçš„å›è°ƒå‡½æ•°ï¼šon_order

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def on_order(context,odr):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |
| odr | orderå§”æ‰˜å¯¹è±¡ | å§”æ‰˜è¯¦æƒ… |

- ğŸ”§ä½œç”¨ï¼š

å§”æ‰˜çŠ¶æ€æ›´æ–°åçš„å›è°ƒå‡½æ•°

- â—æ³¨æ„äº‹é¡¹ï¼š

å›æµ‹æ—¶ä¸‹å•åç«‹åˆ»è§¦å‘ï¼Œä»¿çœŸäº¤æ˜“æ—¶ä¼šåœ¨handle_baræ‰§è¡Œå®Œåè§¦å‘

- ğŸ“ç¤ºä¾‹ï¼š

```
#äº¤æ˜“æ—¥ç»“æŸåï¼Œæ‰“å°ç»„åˆç›ˆäº
def on_order(context,odr):
    log.info(odr)
â€‹
```

#### æœ‰æˆäº¤åçš„å›è°ƒå‡½æ•°ï¼šon_trade

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
def on_trade(context,trade):

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| context | contextå¯¹è±¡ | ç”¨æ¥å­˜æ”¾å½“å‰è´¦æˆ·èµ„é‡‘ã€æŒä»“ä¿¡æ¯ç­‰æ•°æ® |
| trade | tradeæˆäº¤å¯¹è±¡ | å§”æ‰˜è¯¦æƒ… |

- ğŸ”§ä½œç”¨ï¼š

æœ‰æˆäº¤åçš„å›è°ƒå‡½æ•°

- â—æ³¨æ„äº‹é¡¹ï¼š

å›æµ‹æ—¶ä¸‹å•åç«‹åˆ»è§¦å‘ï¼Œä»¿çœŸäº¤æ˜“æ—¶ä¼šåœ¨handle_baræ‰§è¡Œå®Œåè§¦å‘

- ğŸ“ç¤ºä¾‹ï¼š

```
#äº¤æ˜“æ—¥ç»“æŸåï¼Œæ‰“å°ç»„åˆç›ˆäº
def on_trade(context,trade):
    log.info(trade)
â€‹
```

### è‡ªå®šä¹‰è¿è¡Œå‡½æ•°

#### æ¯æ—¥å®šæ—¶è¿è¡Œå‡½æ•°ï¼šrun_daily

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
run_daily(func, time_rule, hours, minutes, reference_security)

- ğŸ”§ä½œç”¨ï¼š

æ¯æ—¥å®šæ—¶è¿è¡Œå‡½æ•°ï¼Œå¦‚éœ€æŒ‡å®šæ—¶é—´è¿è¡Œï¼Œéœ€è¦åœ¨åˆ†é’Ÿçº§ç­–ç•¥ä½¿ç”¨è¯¥å‡½æ•°

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

funcï¼šéœ€è¦æ‰§è¡Œçš„å‡½æ•°
time_ruleï¼šæ—¶é—´è®¡ç®—è§„åˆ™ï¼Œå¯é€‰ä¸‰ç§ä¼ å…¥å€¼ï¼š'after_open'ã€'before_close'å’Œ 'every_bar'

'after_open'ï¼šå¼€ç›˜åï¼ˆä¹‹åçš„ä¸¤ä¸ªå‚æ•°hourså’Œminuteså¯è®¾ç½®å¼€ç›˜åå¤šä¹…è¿è¡Œï¼Œå–å€¼èŒƒå›´ä¸º1åˆ†é’Ÿè‡³4å°æ—¶ï¼‰
'before_close'ï¼šæ”¶ç›˜å‰ï¼ˆä¹‹åçš„ä¸¤ä¸ªå‚æ•°hourså’Œminuteså¯è®¾ç½®æ”¶ç›˜å‰å¤šä¹…è¿è¡Œï¼Œå–å€¼èŒƒå›´ä¸º1åˆ†é’Ÿè‡³4å°æ—¶ï¼‰
'every_bar'ï¼šæ¯åˆ†é’Ÿéƒ½ä¼šè¿è¡Œï¼ˆæ— éœ€å†é¢å¤–ä¼ å…¥hourså’Œminuteså‚æ•°ï¼‰

hoursï¼šè¿è¡Œæ—¶é—´(å°æ—¶)
minutes ï¼šè¿è¡Œæ—¶é—´(åˆ†é’Ÿ)
reference_security ï¼šå‚è€ƒæ ‡çš„é€‰å–ï¼Œç¡®å®šäº¤æ˜“æ—¶é—´

è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡ç¥¨,ä¾‹å¦‚:reference_security= '000001.SZ', åˆ™äº¤æ˜“æ—¶é—´ä¸º9:30-15:00-
è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡æŒ‡æœŸè´§,ä¾‹å¦‚: reference_security= 'IC1508'ï¼Œåˆ™äº¤æ˜“æ—¶é—´åˆ†ä¸º9:15-15:15å’Œ9:30-15:00ä¸¤ç§,ä»¥20160101åˆ’åˆ†
é»˜è®¤ä¸ºè‚¡ç¥¨

- â—æ³¨æ„äº‹é¡¹ï¼š

å¦‚æœåœ¨æ—¥é¢‘ç­–ç•¥ä¸­ä½¿ç”¨è¯¥å‡½æ•°ï¼Œä¸éœ€è¦ä¼ å…¥ time_rule, hours, minutesï¼Œé»˜è®¤åœ¨9ç‚¹31åˆ†æ‰§è¡Œï¼Œå®é™…å’Œæ—¥é¢‘ handle_baræ•ˆæœç›¸åŒ
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ä¸å¡«å†™ï¼Œåˆ™è‡ªåŠ¨é»˜è®¤ä¸ºè‚¡ç¥¨æ ‡çš„
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ï¼Œå¦‚æœä»¥è‚¡ç¥¨ä¸ºæ ‡çš„ï¼Œåˆ™ä¼ å…¥ä»»ä½•ä¸€ä¸ªè‚¡ç¥¨ä»£ç éƒ½æ˜¯å¯ä»¥çš„ï¼ŒæœŸè´§åŒç†
è¯¥å‡½æ•°çš„ time_ruleå‚æ•°ï¼Œå¦‚æœå¡«å†™ 'every_bar'ï¼Œåˆ™ä¸éœ€è¦å¡«å†™ hourså’Œ minutesä¸¤ä¸ªå‚æ•°ï¼Œå¦‚æœå¡«å†™äº†ï¼Œæ˜¯æ— æ•ˆçš„ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸å½±å“è¿è¡Œ

- ğŸ“ç¤ºä¾‹ï¼š

ç¤ºä¾‹ä¸€

def init(context):
# æ¯ä¸ªäº¤æ˜“æ—¥å¼€ç›˜å30åˆ†æ‰§è¡Œä¸€æ¬¡
    run_daily(func=test_day, time_rule='after_open', hours=0, minutes=30, reference_security='000856.SZ')

def test_day(context, bar_dict):
    log.info('å®šæ—¶è¿è¡Œ')
â€‹

#### æ¯å‘¨å®šæ—¶è¿è¡Œå‡½æ•°ï¼šrun_weekly

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
run_weekly(func, date_rule, reference_security)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| func | æ‰§è¡Œçš„å‡½æ•° | ä¸€èˆ¬ä¸ºè‡ªå®šä¹‰å‡½æ•°ï¼Œå®ç°ç‰¹å®šç›®æ ‡ |
| date_rule | æ—¶é—´è®¡ç®—è§„åˆ™ | date_ruleä¸ºæ­£æ•°(å–å€¼èŒƒå›´ä¸º[1,5])è¡¨ç¤ºä¸ºæ¯å‘¨çš„ç¬¬å‡ ä¸ªäº¤æ˜“æ—¥ï¼Œè´Ÿæ•°(å–å€¼èŒƒå›´ä¸º[-5,-1])è¡¨ç¤ºä¸ºæ¯å‘¨å€’æ•°ç¬¬å‡ ä¸ªäº¤æ˜“æ—¥ |
| reference_security | å‚è€ƒæ ‡çš„é€‰å–ï¼Œç¡®å®šäº¤æ˜“æ—¶é—´ | - è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡ç¥¨,ä¾‹å¦‚:reference_security= '000001.SZ', åˆ™äº¤æ˜“æ—¶é—´ä¸º9:30-15:00- è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡æŒ‡æœŸè´§,ä¾‹å¦‚: reference_security= 'IC1508'ï¼Œåˆ™äº¤æ˜“æ—¶é—´åˆ†ä¸º9:15-15:15å’Œ9:30-15:00ä¸¤ç§,ä»¥20160101åˆ’åˆ†- é»˜è®¤ä¸ºè‚¡ç¥¨ |

- ğŸ”§ä½œç”¨ï¼š

æ¯å‘¨å®šæ—¶è¿è¡Œå‡½æ•°,æŒ‡å®šæ—¥å¼€ç›˜æ—¶è¿è¡Œ

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ—¢å¯ä»¥ç”¨äºåˆ†é’Ÿçº§ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ—¥çº§ç­–ç•¥
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ä¸å¡«å†™ï¼Œåˆ™è‡ªåŠ¨é»˜è®¤ä¸ºè‚¡ç¥¨æ ‡çš„
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ï¼Œå¦‚æœä»¥è‚¡ç¥¨ä¸ºæ ‡çš„ï¼Œåˆ™ä¼ å…¥ä»»ä½•ä¸€ä¸ªè‚¡ç¥¨ä»£ç éƒ½æ˜¯å¯ä»¥çš„ï¼ŒæœŸè´§åŒç†
è¯¥å‡½æ•°çš„ date_ruleå‚æ•°ï¼Œå¿…é¡»å¡«å†™(å–å€¼èŒƒå›´ä¸º1è‡³5æˆ–-5è‡³-1),å¦‚æœå¤§äº5,åˆ™ä¼šæŠ¥é”™.å¦‚æœå°äº-5,ç­–ç•¥ä¼šç»§ç»­è¿è¡Œ,ä½†æ˜¯è¯¥å‡½æ•°ä¸ç”Ÿæ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

ç¤ºä¾‹ä¸€

def init(context):
    # æ¯å‘¨ç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥æ‰§è¡Œ
    run_weekly(func=test_week, date_rule=1, reference_security='000001.SZ')

def test_week(context, bar_dict):
    log.info('å®šæ—¶è¿è¡Œ')
â€‹

#### æ¯æœˆå®šæ—¶è¿è¡Œå‡½æ•°ï¼šrun_monthly

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
run_monthly(func, date_rule, reference_security)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| func | æ‰§è¡Œçš„å‡½æ•° | ä¸€èˆ¬ä¸ºè‡ªå®šä¹‰å‡½æ•°ï¼Œå®ç°ç‰¹å®šç›®æ ‡ |
| date_rule | æ—¶é—´è®¡ç®—è§„åˆ™ | date_ruleä¸ºæ­£æ•°(å–å€¼èŒƒå›´ä¸º[1,23])è¡¨ç¤ºä¸ºæ¯æœˆçš„ç¬¬å‡ ä¸ªäº¤æ˜“æ—¥ï¼Œè´Ÿæ•°(å–å€¼èŒƒå›´ä¸º[-23,-1])è¡¨ç¤ºä¸ºæ¯æœˆå€’æ•°ç¬¬å‡ ä¸ªäº¤æ˜“æ—¥ |
| reference_security | å‚è€ƒæ ‡çš„é€‰å–ï¼Œç¡®å®šäº¤æ˜“æ—¶é—´ | - è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡ç¥¨,ä¾‹å¦‚:reference_security= '000001.SZ', åˆ™äº¤æ˜“æ—¶é—´ä¸º9:30-15:00- è‹¥å‚è€ƒæ ‡çš„ä¸ºè‚¡æŒ‡æœŸè´§,ä¾‹å¦‚: reference_security= 'IC1508'ï¼Œåˆ™äº¤æ˜“æ—¶é—´åˆ†ä¸º9:15-15:15å’Œ9:30-15:00ä¸¤ç§,ä»¥20160101åˆ’åˆ†- é»˜è®¤ä¸ºè‚¡ç¥¨ |

- ğŸ”§ä½œç”¨ï¼š

æ¯æœˆå®šæ—¶è¿è¡Œå‡½æ•°,æŒ‡å®šæ—¥å¼€ç›˜æ—¶è¿è¡Œ

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ—¢å¯ä»¥ç”¨äºåˆ†é’Ÿçº§ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ—¥çº§ç­–ç•¥
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ä¸å¡«å†™ï¼Œåˆ™è‡ªåŠ¨é»˜è®¤ä¸ºè‚¡ç¥¨æ ‡çš„
æ­¤å‡½æ•°ä¸­ reference_securityå‚æ•°ï¼Œå¦‚æœä»¥è‚¡ç¥¨ä¸ºæ ‡çš„ï¼Œåˆ™ä¼ å…¥ä»»ä½•ä¸€ä¸ªè‚¡ç¥¨ä»£ç éƒ½æ˜¯å¯ä»¥çš„ï¼ŒæœŸè´§åŒç†
è¯¥å‡½æ•°çš„ date_ruleå‚æ•°ï¼Œå¿…é¡»å¡«å†™(å–å€¼èŒƒå›´ä¸º1è‡³23æˆ–-23è‡³-1),è¾“å…¥æ•°å€¼è¶…å‡ºèŒƒå›´,åˆ™ä¼šæŠ¥é”™

- ğŸ“ç¤ºä¾‹ï¼š

ç¤ºä¾‹ä¸€

def init(context):
    # æ¯æœˆç¬¬5ä¸ªäº¤æ˜“æ—¥æ‰§è¡Œ
    run_monthly(func=test_month, date_rule=5, reference_security='000001.SZ')

def test_month(context, bar_dict):
    log.info('å®šæ—¶è¿è¡Œ')
â€‹

### è®¾ç½®å‡½æ•°

#### è®¾ç½®åŸºå‡†æ”¶ç›Šï¼šset_benchmark

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_benchmark(symbol)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| --- | --- | --- |
| symbol | è‚¡ç¥¨æˆ–è€…å…¶ä»–å“ç§ä»£ç  | ä¾‹å¦‚ï¼šæ²ªæ·±300ï¼š'000300.SH', å›½å€ºETF: '511010.OF' |

- ğŸ”§ä½œç”¨ï¼š

set_benchmarkå‡½æ•°ç”¨äºè®¾ç½®åŸºå‡†æ”¶ç›Š, å…¶ä¸å½±å“ç­–ç•¥çš„è¿è¡Œ

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ˜¯è®¾ç½®å‡½æ•°, å±äºåˆå§‹è®¾ç½®æ¡ä»¶, å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™éƒ½æ˜¯æ— æ•ˆçš„
è¯¥å‡½æ•°çš„ symbolå‚æ•°, å¿…é¡»è¾“å…¥å­—ç¬¦ä¸², ä¸”åªèƒ½è¾“å…¥ä¸€ä¸ªä»£ç , ä¾‹å¦‚: ['000300.SH']æ˜¯é”™çš„, '000300.SH'æ˜¯å¯¹çš„
å¦‚æœæ•´ä¸ªç­–ç•¥æ²¡æœ‰è¯¥å‡½æ•°, åˆ™é»˜è®¤ç­–ç•¥çš„åŸºå‡†ä¸ºæ²ªæ·±300æŒ‡æ•°

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #åˆå§‹åŒ–ç­–ç•¥æ—¶è®¾ç½®åŸºå‡†ä¸ºæ²ªæ·±300æŒ‡æ•°
    set_benchmark('000300.SH')
â€‹

#### è®¾ç½®ç­–ç•¥æ»‘ç‚¹ï¼šset_slippage

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_slippage(slippage)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

slippage:PriceSlippageæˆ–FixedSlippageå¯¹è±¡

PriceSlippageï¼šå¯å˜æ»‘ç‚¹å¯¹è±¡ï¼Œä¾‹å¦‚PriceSlippage(0.1)ï¼Œè¡¨ç¤ºä¹°å…¥ä»·ä¸ºå®é™…ä»·æ ¼ä¹˜1.05ï¼Œå–å‡ºä»·ä¸ºå®é™…ä»·æ ¼ä¹˜0.95
FixedSlippageï¼šå›ºå®šæ»‘ç‚¹å¯¹è±¡ï¼Œä¾‹å¦‚FixedSlippage(10)ï¼Œè¡¨ç¤ºä¹°å…¥ä»·ä¸ºå®é™…ä»·æ ¼åŠ 5ï¼Œå–å‡ºä»·ä¸ºå®é™…ä»·æ ¼å‡5

- ğŸ”§ä½œç”¨ï¼š

set_slippageå‡½æ•°ç”¨äºè®¾ç½®ç­–ç•¥æ»‘ç‚¹, å…¶ä¸å½±å“ç­–ç•¥çš„è¿è¡Œï¼Œé»˜è®¤ä¸º0.002çš„å¯å˜æ»‘ç‚¹

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ˜¯è®¾ç½®å‡½æ•°, å±äºåˆå§‹è®¾ç½®æ¡ä»¶, å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ˜¯æ— æ•ˆçš„

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®å¯å˜æ»‘ç‚¹2%ï¼Œè¡¨ç¤ºä¹°å…¥ä»·ä¸ºå®é™…ä»·æ ¼ä¹˜101%ï¼Œå–å‡ºä»·ä¸ºå®é™…ä»·æ ¼ä¹˜99%
    set_slippage(PriceSlippage(0.02))
â€‹

#### è®¾ç½®äº¤æ˜“æ‰‹ç»­è´¹ï¼šset_commission

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_commission(cal_style)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

cal_style:PerShareæˆ–PerTradeå¯¹è±¡

PerShareï¼šæ¯”ä¾‹äº¤æ˜“æ‰‹ç»­è´¹ï¼Œä¾‹å¦‚ PerShare(type='stock',cost=0.0002)ï¼Œè¡¨ç¤ºæ‰‹ç»­è´¹ä¸ºäº¤æ˜“é¢çš„0.02%
PerTradeï¼šå›ºå®šäº¤æ˜“æ‰‹ç»­è´¹ï¼Œä¾‹å¦‚ PerTrade(type='future',cost=5.0)ï¼Œè¡¨ç¤ºæ¯ç¬”äº¤æ˜“æ‰‹ç»­è´¹5å…ƒ

- ğŸ”§ä½œç”¨ï¼š

set_commissionå‡½æ•°ç”¨æ¥è®¾ç½®äº¤æ˜“æ‰‹ç»­è´¹ï¼Œå…¶ä¸å½±å“ç­–ç•¥çš„è¿è¡Œ,é»˜è®¤äº¤æ˜“æ‰‹ç»­è´¹ä¸ºï¼šäº¤æ˜“é¢çš„0.02%

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®è‚¡ç¥¨æ‰‹ç»­è´¹ä¸ºäº¤æ˜“é¢çš„0.01%(ä¸‡ä¸€)ï¼Œæœ€ä½æ‰‹ç»­è´¹ä¸º0å…ƒ(å…5)
    set_commission(PerShare(type='stock',cost=0.0001,min_trade_cost=0.0))
â€‹

#### è®¾ç½®å›æµ‹ç­–ç•¥è´¦æˆ·åˆå§‹æŒä»“ï¼šset_holding_stocks

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_holding_stocks(holdings)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

holdings:dictå¯¹è±¡ï¼Œkeyä¸ºæŒä»“çš„symbolï¼Œvalueä¸ºæŒä»“çš„æ•°é‡(å¿…é¡»ä¸ºæ­£æ•´æ•°)

- ğŸ”§ä½œç”¨ï¼š

set_holding_stockså‡½æ•°ç”¨æ¥è®¾ç½®å›æµ‹ç­–ç•¥è´¦æˆ·åˆå§‹æŒä»“(è®¾ç½®åˆå§‹æŒä»“å¹¶ä¸ä¼šå‡å°‘è´¦æˆ·çš„åˆå§‹èµ„é‡‘)

- â—æ³¨æ„äº‹é¡¹ï¼š

è‹¥è¿›è¡Œç­–ç•¥å›æµ‹, åˆ™è¯¥å‡½æ•°é»˜è®¤ä½¿ç”¨å›æµ‹å¼€å§‹æ—¥æœŸçš„å‰ä¸€ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜ä»·æŒæœ‰åˆå§‹æŒä»“
è‹¥å›æµ‹èµ·å§‹æ—¥æœŸå°äºç­‰äºæ‰€æ·»åŠ è‚¡ç¥¨çš„ä¸Šå¸‚æ—¥æœŸæˆ–è‚¡ç¥¨å·²ç»é€€å¸‚, åˆ™æ— æ³•æ·»åŠ è¯¥è‚¡ç¥¨æŒä»“
è¯¥å‡½æ•°å¿…é¡»åœ¨initå‡½æ•°ä¸‹è®¾ç½®,å¦åˆ™æ˜¯æ— æ•ˆçš„

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®ç­–ç•¥åˆå§‹æŒä»“
    set_holding_stocks({'000001.SZ': 200,'300033.SZ': 500,'600519.SH': 700})
â€‹

#### è®¾ç½®è®¾ç½®å­è´¦æˆ·ï¼šset_subportfolios

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_subportfolios([dict_1,dict_2,...])

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

dict_1:dictå¯¹è±¡ï¼Œkeyä¸º cashã€typeçš„å­—å…¸

cash:å­è´¦æˆ·åˆå§‹èµ„é‡‘,ä¾‹å¦‚:'cash':500000,è®¾ç½®å­è´¦æˆ·åˆå§‹èµ„é‡‘ä¸º50ä¸‡
type:å­è´¦æˆ·ç±»å‹,ä¾‹å¦‚ï¼š 'type': 'future',è®¾ç½®è¯¥å­è´¦æˆ·ä¸ºæœŸè´§è´¦æˆ·.é…åˆ'cash'ä¸€èµ·ä½¿ç”¨:{'cash':500000,'type':'future'}

- ğŸ”§ä½œç”¨ï¼š

set_subportfolioså‡½æ•°ç”¨æ¥è®¾ç½®è®¾ç½®å­è´¦æˆ·

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°è®¾ç½®åï¼Œå­è´¦æˆ·åˆå§‹èµ„é‡‘ä¹‹å’Œå¿…é¡»ç­‰äºæ€»çš„åˆå§‹èµ„é‡‘(å›æµ‹æ—¶éœ€è¦å¡«å†™æ€»çš„åˆå§‹èµ„é‡‘)
æ¨¡æ‹Ÿäº¤æ˜“æ—¶ï¼Œå‡½æ•°è®¾ç½®çš„æœŸè´§å’Œè‚¡ç¥¨è´¦æˆ·èµ„é‡‘å¿…é¡»å¯¹åº”æ¨¡æ‹Ÿäº¤æ˜“ä¸­æœŸè´§å’Œè‚¡ç¥¨è´¦æˆ·çš„èµ„é‡‘ã€‚è®¾ç½®å‡½æ•°æˆ–è€…åˆ›å»ºæ¨¡æ‹Ÿè´¦æˆ·æ—¶,å¿…é¡»è€ƒè™‘åˆ°è¿™ç‚¹,ä¸ç„¶æ— æ³•æ­£å¸¸æ¨¡æ‹Ÿäº¤æ˜“
å¦‚æœæ•´ä¸ªç­–ç•¥æ²¡æœ‰è¯¥å‡½æ•°,åˆ™æ— æ³•è¿›è¡ŒæœŸè´§äº¤æ˜“
è¯¥å‡½æ•°å¿…é¡»åœ¨initå‡½æ•°ä¸‹è®¾ç½®,å¦åˆ™æ˜¯æ— æ•ˆçš„

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®å­è´¦æˆ·,è‚¡ç¥¨è´¦æˆ·50ä¸‡ï¼ŒæœŸè´§è´¦æˆ·50ä¸‡.
    set_subportfolios([{'cash':500000,'type':'stock'},{'cash':500000,'type':'future'}])
â€‹

#### è®¾ç½®æœ€å¤§æˆäº¤æ¯”ä¾‹ï¼šset_volume_limit

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_volume_limit(daily, minute)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

daily:floatï¼Œä¾‹å¦‚ daily=0.25,åˆ™æ„å‘³ç€ä¸‹å•æ•°é‡è¶…è¿‡æ—¥çº¿çº§æˆäº¤é‡25%çš„éƒ¨åˆ†æ— æ³•æˆäº¤ï¼›daily=None,åˆ™è¡¨ç¤ºä¸åšæˆäº¤é‡é™åˆ¶
minute:floatï¼Œä¾‹å¦‚ minute=0.5,åˆ™æ„å‘³ç€ä¸‹å•æ•°é‡è¶…è¿‡åˆ†é’Ÿçº¿çº§æˆäº¤é‡50%çš„éƒ¨åˆ†å°±æ— æ³•æˆäº¤ï¼›minute=None,åˆ™è¡¨ç¤ºä¸åšæˆäº¤é‡é™åˆ¶

- ğŸ”§ä½œç”¨ï¼š

set_volume_limitå‡½æ•°ç”¨æ¥è®¾ç½®æœ€å¤§æˆäº¤æ¯”ä¾‹,è‹¥ä¸‹å•æ•°é‡è¶…è¿‡å½“å‰æ—¶é—´å‘¨æœŸçš„æˆäº¤é‡ä¸€å®šæ¯”ä¾‹ï¼Œåˆ™æŒ‰å…è®¸çš„æœ€å¤§æ•°é‡æˆäº¤

- â—æ³¨æ„äº‹é¡¹ï¼š

å¦‚æœç­–ç•¥æ²¡æœ‰è¯¥å‡½æ•°ï¼Œåˆ™é»˜è®¤daily=0.25ï¼Œminute=0.5
è¯¥å‡½æ•°è®¾ç½®åï¼Œä¸€æ—¦è§¦å‘ï¼Œåˆ™æœ¬æ¬¡ä¸‹å•å¯èƒ½ä¼šéƒ¨åˆ†æˆäº¤

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®æœ€å¤§æˆäº¤æ¯”ä¾‹æ—¥çº§æˆäº¤é‡æ¯”ä¾‹50%,åˆ†é’Ÿçº§æˆäº¤é‡æ¯”ä¾‹50%
    set_volume_limit(daily=0.5, minute=0.5)
â€‹

#### è®¾ç½®ä¸‹å•åå»¶è¿Ÿæˆäº¤æ—¶é—´ï¼šset_trade_delay

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_trade_delay(delay_time)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

delay_time:intï¼Œå»¶è¿Ÿdelay_timeä¸ªbaråæˆäº¤ï¼Œä¾‹å¦‚ delay_time=5

åœ¨æ—¥çº§å›æµ‹ä¸­ä¸‹å•åï¼Œå»¶è¿Ÿ5ä¸ªäº¤æ˜“æ—¥æˆäº¤
åœ¨åˆ†é’Ÿçº§å›æµ‹ä¸­ä¸‹å•åï¼Œæ¨è¿Ÿ5åˆ†é’Ÿæˆäº¤

- ğŸ”§ä½œç”¨ï¼š

è®¾ç½®ä¸‹å•åå»¶è¿Ÿæˆäº¤æ—¶é—´

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åœ¨æ¨¡æ‹Ÿäº¤æ˜“ä¸­æ— æ•ˆï¼Œåªèƒ½åœ¨å›æµ‹ç¯å¢ƒä¸­ä½¿ç”¨å®ƒ
è¯¥å‡½æ•°å¿…é¡»åœ¨init(context)å‡½æ•°ä¸‹è®¾ç½®,å¦åˆ™æ— æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #ä¸‹å•åæ¨è¿Ÿ3åˆ†é’Ÿ/äº¤æ˜“æ—¥æˆäº¤
    set_trade_delay(delay_time=3)
â€‹

#### è®¾ç½®logè¾“å‡ºçº§åˆ«ï¼šset_log_level

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_log_level(level,is_limit=True,filename=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

level:strï¼Œlogå¯¹åº”çš„çº§åˆ«ï¼Œå¦‚æœè®¾å®šlevelä¸º'warn',åˆ™logæ‰“å°å‡½æ•°åªä¼šæ‰“å°'warn'ã€'error'çº§åˆ«
is_limit:bool,æ—¥å¿—æ•°é‡é™åˆ¶ï¼Œé»˜è®¤Trueä¸º10000æ¡
filename:strï¼Œé‡å®šå‘æ—¥å¿—æ–‡ä»¶è·¯å¾„(ä»…ç ”ç©¶å¹³å°æœ‰æ•ˆ)

- ğŸ”§ä½œç”¨ï¼š

set_log_levelå‡½æ•°ç”¨æ¥è®¾ç½®logè¾“å‡ºçº§åˆ«,logæ‰“å°ä¸€èˆ¬æœ‰ä¸‰ç§log.info()ã€log.warn()ã€log.error(),ä¼˜å…ˆçº§æ’åºä¸ºï¼šerror>warn>info

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ä¸ä»…å¯ä»¥åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®,ä¹Ÿå¯ä»¥åœ¨ handle_bar(context, bar_dict)å‡½æ•°ä¸‹è®¾ç½®
å½“log.error()æ‰“å°æ•°æ®æ—¶,æ•´ä¸ªå›æµ‹å°±ä¼šåœæ­¢,ç±»ä¼¼ä¸€ä¸ªæŠ¥é”™ç»ˆæ­¢æœºåˆ¶

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾ç½®æ—¥å¿—çº§åˆ«:warn
    set_log_level(level='warn')
â€‹

#### è®¾ç½®å›æµ‹æˆäº¤æœºåˆ¶ï¼šset_execution

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_execution(str)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

str:æ’®åˆæˆäº¤æœºåˆ¶ï¼Œå¯é€‰'close','next_open'

'close':å½“å‰baræ”¶ç›˜ä»·æ’®åˆ
'next_open':ä¸‹ä¸€ä¸ªbarå¼€ç›˜ä»·æ’®åˆ

- ğŸ”§ä½œç”¨ï¼š

set_executionå‡½æ•°ç”¨æ¥è®¾ç½®å›æµ‹æˆäº¤æœºåˆ¶, ä¸åŒçš„è®¾ç½®ä¼šé‡‡ç”¨ä¸åŒçš„ä»·æ ¼è¿›è¡Œæ’®åˆæˆäº¤(åªåœ¨åˆ†é’Ÿå›æµ‹ä¸­æœ‰æ•ˆï¼Œé»˜è®¤next_open)

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ
è¯¥å‡½æ•°çš„strå‚æ•°, å¿…é¡»è¾“å…¥å­—ç¬¦ä¸², ä¸”åªèƒ½è¾“å…¥ä¸€ä¸ªï¼Œä¾‹å¦‚: set_execution('next_open')
å¦‚æœæ•´ä¸ªç­–ç•¥æ²¡æœ‰è¯¥å‡½æ•°, åˆ™é»˜è®¤ç­–ç•¥é‡‡ç”¨next_openæ¨¡å¼è¿›è¡Œå›æµ‹

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    #åˆå§‹åŒ–ç­–ç•¥æ—¶è®¾ç½®æ’®åˆæœºåˆ¶ä¸ºä¸‹ä¸€ä¸ªbarçš„open
    set_execution('next_open')
â€‹
```

#### è°ƒæ•´handle_barè¿è¡Œæ—¶é—´ï¼šenable_open_bar

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
enable_open_bar()

- ğŸ”§ä½œç”¨ï¼š

è¯¥å‡½æ•°åœ¨initè°ƒç”¨ï¼ŒåŠŸèƒ½ä¸ºåœ¨è‚¡ç¥¨æ—¥çº§å›æµ‹ä¸­ï¼Œhandle_baræ‰§è¡Œæ—¶é—´è°ƒæ•´ä¸º9:30ï¼›åœ¨åˆ†é’Ÿçº§å›æµ‹ä¸­ï¼Œhandle_baråœ¨9:30å¢åŠ ä¸€æ¬¡è¿è¡Œ

- ğŸ“ç¤ºä¾‹ï¼š

# è‚¡ç¥¨ç­–ç•¥æ¨¡ç‰ˆ
# åˆå§‹åŒ–å‡½æ•°,å…¨å±€åªè¿è¡Œä¸€æ¬¡
def init(context):
    enable_open_bar()

#æ¯æ—¥å¼€ç›˜å‰9:00è¢«è°ƒç”¨ä¸€æ¬¡,ç”¨äºå‚¨å­˜è‡ªå®šä¹‰å‚æ•°ã€å…¨å±€å˜é‡,æ‰§è¡Œç›˜å‰é€‰è‚¡ç­‰
def before_trading(context):
    pass

## å¼€ç›˜æ—¶è¿è¡Œå‡½æ•°
def handle_bar(context, bar_dict):
    order("300033.SZ", 100)

## æ”¶ç›˜åè¿è¡Œå‡½æ•°,ç”¨äºå‚¨å­˜è‡ªå®šä¹‰å‚æ•°ã€å…¨å±€å˜é‡,æ‰§è¡Œç›˜åé€‰è‚¡ç­‰
def after_trading(context):
    pass
â€‹

#### å®šä¹‰åˆ—å¼è®¡ç®—çš„ä¿¡å·åä»¥åŠè®¡ç®—æ–¹å¼ï¼šreg_signal

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
reg_signal(name,func)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

name:æŒ‡æ ‡è®¡ç®—åç§°
func:æŒ‡æ ‡çš„è®¡ç®—æ–¹å¼,å®šä¹‰æ–¹å¼ä¸º def func(data):,dataä»£è¡¨è®¢é˜…çš„tickæ•°æ®,æ ¼å¼ä¸ºpd.DataFrame,è¿”å›å€¼ä¸ºä¸€ä¸ªç´¢å¼•ä¸dataå¯¹é½çš„pd.Series

- ğŸ”§ä½œç”¨ï¼š

å®šä¹‰åˆ—å¼è®¡ç®—çš„ä¿¡å·åä»¥åŠè®¡ç®—æ–¹å¼

- â—æ³¨æ„äº‹é¡¹ï¼š

è‹¥è®¢é˜…äº†å¤šåªè‚¡ç¥¨ï¼Œåˆ™å¯¹æ¯åªè‚¡ç¥¨åˆ†åˆ«è¿›è¡Œè®¡ç®—
éœ€è¦ä¸get_signalé…åˆä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
#å®šä¹‰ä¸€ä¸ªåä¸ºâ€™bigâ€™çš„ä¿¡å·ï¼Œç®—æ³•ä¸ºtickæ•°æ®å¤§äº10ç­‰äºTrueï¼Œå¦åˆ™ç­‰äºFalse.
def init(context):
    reg_signal('big',get_big)

def get_big(data):
    return data[â€˜currentâ€™]>10
â€‹
```

#### è®¾ç½®æŸä¸€å“ç§çš„ä¿è¯é‡‘æ¯”ä¾‹ï¼šset_margin_rate

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_margin_rate(symbol,long_value,short_value)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol:æ ‡çš„ä»£ç 
long_value:åšå¤šä¿è¯é‡‘æ¯”ä¾‹
short_value:åšç©ºä¿è¯é‡‘æ¯”ä¾‹

- ğŸ”§ä½œç”¨ï¼š

- è¯¥å‡½æ•°ç”¨äºè®¾ç½®æŸä¸€å“ç§çš„ä¿è¯é‡‘æ¯”ä¾‹

- ğŸ“ç¤ºä¾‹ï¼š

# è®¾ç½®èºçº¹é’¢çš„ä¿è¯é‡‘æ¯”ä¾‹ä¸º9%
def init(context):
    set_margin_rate('RB',0.09,0.09)
â€‹

#### è®¾ç½®æœŸæƒæ‰‹ç»­è´¹ï¼šset_option_commission

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_option_commission(cost)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

cost:å•å¼ æœŸæƒåˆçº¦çš„æ‰‹ç»­è´¹(å…ƒ)

- ğŸ”§ä½œç”¨ï¼š

è¯¥å‡½æ•°è®¾ç½®æœŸæƒæ‰‹ç»­è´¹ï¼ˆå…ƒ/å•å¼ 10000ä»½ï¼‰ï¼Œé»˜è®¤ä¸º5å…ƒ

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

# è®¾ç½®æœŸæƒæ‰‹ç»­è´¹ä¸º10å…ƒ/å¼ 
def init(context):
    set_option_commission(10)
â€‹

#### è®¾ç½®æœŸæƒäº¤æ˜“æ»‘ç‚¹ï¼šset_option_slippage

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_option_slippage(rate)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

rate:è®¾ç½®çš„æœŸæƒäº¤æ˜“æµ®åŠ¨æ»‘ç‚¹æ¯”ä¾‹

- ğŸ”§ä½œç”¨ï¼š

è¯¥å‡½æ•°è®¾ç½®æœŸæƒäº¤æ˜“æ»‘ç‚¹, å…¶ä¸å½±å“ç­–ç•¥çš„è¿è¡Œï¼Œé»˜è®¤ä¸º0.001

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

# è®¾ç½®æœŸæƒäº¤æ˜“æ»‘ç‚¹ä¸ºåŒè¾¹0.004(å•è¾¹0.002)
def init(context):
    set_option_slippage(0.004)
â€‹

#### è®¾ç½®åœºå¤–åŸºé‡‘ç”³è´­æŠ˜æ‰£ç‡ï¼šset_discount_rate

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_discount_rate(rate)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

rate:åŸºé‡‘ç”³è´­æŠ˜æ‰£ç‡ï¼Œåœ¨0åˆ°1ä¹‹é—´ï¼Œé»˜è®¤ä¸º0.1

- ğŸ”§ä½œç”¨ï¼š

è¯¥å‡½æ•°è®¾ç½®åœºå¤–åŸºé‡‘ç”³è´­æŠ˜æ‰£ç‡

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    # åˆå§‹åŒ–ç­–ç•¥æ—¶è®¾ç½®æŠ˜æ‰£ç‡10%
    set_discount_rate(0.1)
â€‹

#### è®¾ç½®åœºå¤–åŸºé‡‘ç”³è´­æŠ˜æ‰£ç‡ï¼šset_dividend_mode

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
set_dividend_mode(mode)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

mode:åŸºé‡‘åˆ†çº¢å¤„ç†æ¨¡å¼ï¼Œå¯é€‰ cash/invest

cash:ç°é‡‘åˆ†çº¢
invest:çº¢åˆ©å†æŠ•èµ„

- ğŸ”§ä½œç”¨ï¼š

è¯¥å‡½æ•°è®¾ç½®åœºå¤–åŸºé‡‘ç”³è´­æŠ˜æ‰£ç‡

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¿…é¡»åœ¨ init(context)å‡½æ•°ä¸‹è®¾ç½®, å¦åˆ™æ— æ•ˆ
å¦‚æœæœªè®¾ç½®ï¼Œç³»ç»Ÿé»˜è®¤ä¸ºçº¢åˆ©å†æŠ•èµ„

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #åˆå§‹åŒ–ç­–ç•¥æ—¶è®¾ç½®åˆ†çº¢æ¨¡å¼ä¸ºçº¢åˆ©å†æŠ•èµ„
    set_dividend_mode(invest)
â€‹

### æ•°æ®å‡½æ•°

- æ­¤éƒ¨åˆ†æ•°æ®æ¥å£ä»…å¯åœ¨ç­–ç•¥å›æµ‹ä»¥åŠæ¨¡æ‹Ÿäº¤æ˜“ä¸­è°ƒç”¨ï¼Œå…¶ä»–åœ°æ–¹æ— æ³•è°ƒç”¨ï¼Œéœ€ä½¿ç”¨é€šç”¨æ•°æ®æ¥å£

#### è®¢é˜…æ ‡çš„ï¼šsubscribe

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
subscribe(id_or_symbols)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_symbols:éœ€è¦è®¢é˜…çš„æ ‡çš„ä»£ç ï¼Œæ”¯æŒå•ä¸ªè®¢é˜…(str)æˆ–å¤šä¸ªè®¢é˜…(list)

- ğŸ”§ä½œç”¨ï¼š

è®¢é˜…æ ‡çš„ï¼Œä½¿åˆçº¦æ± å†…åˆçº¦å¢åŠ 

- â—æ³¨æ„äº‹é¡¹ï¼š

ç­–ç•¥ä¼šæ ¹æ®è®¢é˜…çš„æ ‡çš„æ‰€å±çš„äº¤æ˜“æ‰€äº¤æ˜“æ—¶é—´çš„å¹¶é›†ç¡®å®šç­–ç•¥æ‰§è¡Œ handle_barã€before_tradingã€after_tradingè¿è¡Œæ—¶é—´ï¼Œé»˜è®¤ä¸ºæ²ªæ·±äº¤æ˜“æ‰€æ—¶é—´
åœ¨tickçº§å›æµ‹ä¸­å¿…é¡»è®¢é˜…åˆçº¦ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘tickè¡Œæƒ…äº‹ä»¶
åœ¨å¤–æ±‡(åŒå‘å®)ç­–ç•¥ä¸­å¿…é¡»è®¢é˜…åˆçº¦
åœ¨T+Dåˆçº¦ç­–ç•¥ä¸­å¿…é¡»è®¢é˜…åˆçº¦

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¢é˜…èºçº¹ä¸»åŠ›åˆçº¦
    subscribe('RB9999')
â€‹

#### å–æ¶ˆè®¢é˜…æ ‡çš„ï¼šunsubscribe

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
unsubscribe(id_or_symbols)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_symbols:éœ€è¦è®¢é˜…çš„æ ‡çš„ä»£ç ï¼Œæ”¯æŒå•ä¸ªè®¢é˜…(str)æˆ–å¤šä¸ªè®¢é˜…(list)

- ğŸ”§ä½œç”¨ï¼š

å–æ¶ˆè®¢é˜…æ ‡çš„ï¼Œä½¿åˆçº¦æ± å†…åˆçº¦å‡å°‘

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¢é˜…èºçº¹ä¸»åŠ›åˆçº¦
    subscribe('RB9999')

def after_trading(context):
    #å–æ¶ˆè®¢é˜…èºçº¹ä¸»åŠ›åˆçº¦
    unsubscribe('RB9999')
â€‹

#### è·å–å½“å‰barçš„æ—¶é—´ï¼šget_datetime

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_datetime()

- ğŸ”§ä½œç”¨ï¼š

è·å–å½“å‰barçš„æ—¶é—´

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œç›´æ¥ä½¿ç”¨
åœ¨tickçº§ç­–ç•¥ä¸­ä½¿ç”¨æ—¶ï¼Œè¿”å›å½“å‰äº¤æ˜“æ—¥çš„å¼€ç›˜æ—¶é—´

- ğŸ“ç¤ºä¾‹ï¼š

from datetime import timedelta as td

def init(context):
    pass 

def handle_bar(context,bar_dict):
    # è·å–å½“å‰barçš„æ—¶é—´
    time = get_datetime()
    log.info(time)
    # è·å–å›æµ‹å‰ä¸€å¤©æ—¥æœŸ
    yesterday_time = get_datetime()-td(days=1)
    yesterday_date = yesterday_time.strftime("%Y%m%d")
    log.info(yesterday_date)
â€‹

#### è·å–ä¸Šä¸€ä¸ªbarçš„æ—¶é—´ï¼šget_last_datetime

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_last_datetime()

- ğŸ”§ä½œç”¨ï¼š

è·å–ä¸Šä¸€ä¸ªbarçš„æ—¶é—´

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œç›´æ¥ä½¿ç”¨
åœ¨tickçº§ç­–ç•¥ä¸­ä½¿ç”¨æ—¶ï¼Œè¿”å›å‰ä¸€äº¤æ˜“æ—¥çš„æ”¶ç›˜æ—¶é—´

- 

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    pass 

def handle_bar(context,bar_dict):
    # è·å–ä¸Šä¸€ä¸ªbarçš„æ—¶é—´
    last_datetime = get_last_datetime()
    log.info('å›æµ‹å‰ä¸€ä¸ªhandle_barè°ƒç”¨æ—¶é—´ï¼š'+str(last_datetime))
â€‹
```

- è¿”å›æ•°æ®ï¼š

pandas.Timestampæ ¼å¼.
ä¾‹å¦‚:2016-08-08 09:30:00

2016-08-08 09:30:00 - INFO
å›æµ‹å½“å¤©æ—¶é—´ï¼š2016-08-08 09:30:00
2016-08-08 09:30:00 - INFO
å›æµ‹å‰ä¸€å¤©æ—¶é—´ï¼š20160807
â€‹

#### è·å–è‚¡ç¥¨å†å²è¡Œæƒ…ï¼šhistory

- ğŸ”§ä½œç”¨ï¼š

è·å–è‚¡ç¥¨å¤šå±æ€§çš„å†å²è¡Œæƒ…æ•°æ®,ä»…å¯åœ¨ç­–ç•¥APIå†…ä½¿ç”¨

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

history(
    symbol_list,
    fields,
    bar_count, 
    fre_step,
    skip_paused = False,
    fq = 'pre',
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

- symbol_list:stræˆ–listï¼Œæ ‡çš„ä»£ç ,å–å•ä¸ªè‚¡ç¥¨æ•°æ®æ—¶å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²ï¼Œè‹¥éœ€è¦å–å¤šä¸ªæ ‡çš„ï¼Œéœ€ä¼ å…¥åˆ—è¡¨

- fields:list,æ•°æ®å­—æ®µ,æ”¯æŒå­—æ®µå¯å‚è€ƒAè‚¡æ—¥è¡Œæƒ…æ•°æ®ã€Aè‚¡åˆ†é’Ÿè¡Œæƒ…æ•°æ®

- bar_count:å†å²é•¿åº¦ï¼Œä¾‹å¦‚ bar_count = 5ï¼Œè¡¨ç¤ºè·å–è¿‡å»5ä¸ªæ—¶é—´æ­¥é•¿çš„å†å²æ•°æ®

- fre_step:æ—¶é—´æ­¥é•¿'Xd'/'Xm',Xå¿…é¡»ä¸ºæ­£æ•´æ•°ï¼Œfre_step = '1d'è¡¨ç¤ºæ—¶é—´æ­¥é•¿ä¸º1å¤©

å½“Xä¸ç­‰äº1æ—¶ï¼Œfieldä»…æ”¯æŒ'open','high','low','close','volume','turnover'è¿™å‡ ä¸ªå­—æ®µ

- skip_paused:æ˜¯å¦è·³è¿‡åœç‰Œæ•°æ®

skip_paused = True:è·³è¿‡åœç‰Œæ•°æ®
skip_paused = False:ä¸è·³è¿‡åœç‰Œæ•°æ®

- fq:å¤æƒé€‰é¡¹,å¯é€‰ä¸å¤æƒã€å‰å¤æƒã€åå¤æƒï¼Œé»˜è®¤ä¸å¤æƒ

fq = Noneï¼šä¸å¤æƒ
fq = 'pre'ï¼šå‰å¤æƒï¼ŒåŠ¨æ€å¤æƒæ¨¡å¼ï¼Œä»¥å½“å‰barçš„æœ€æ–°ä»·ä½œä¸ºåŸºå‡†å‘å‰å¤æƒï¼Œè¯¦æƒ…å¯å‚è€ƒæ‹†åˆ†ã€åˆå¹¶ä¸åˆ†çº¢
fq = 'post'ï¼šåå¤æƒ

- â—æ³¨æ„äº‹é¡¹ï¼š

ç”±äºç­–ç•¥æ¡†æ¶çš„è¿è¡Œæœºåˆ¶ï¼Œå–æ—¥é¢‘å†å²è¡Œæƒ…æ—¶ï¼Œä¸åŒ…å«å½“å‰barçš„æ•°æ®ï¼›å–åˆ†é’Ÿé¢‘å†å²è¡Œæƒ…ï¼ŒåŒ…å«å½“å‰baræ•°æ®

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    pass

def handle_bar(context,bar_dict):
    #è·å–ä¸‡ç§‘Aä¸å¹³å®‰é“¶è¡Œè¿‡å»10æ—¥çš„æ”¶ç›˜ä»·ä¸æœ€é«˜ä»·ï¼Œå¹¶ä¸”è¾“å‡ºæ•°æ®
    price=history(['000001.SZ','000002.SZ'], ['close','high'], 10, '1d', False, 'pre')
    log.info('æ”¶ç›˜ä»·ï¼š'+str(price['close']))
    log.info('æœ€é«˜ä»·ï¼š'+str(price['high'])
â€‹

- è¿”å›æ•°æ®ï¼š

è¿”å›dictå¯¹è±¡ï¼Œå…¶keyæ˜¯symbolå³è¯åˆ¸ä»£ç ã€å€¼æ˜¯pandas.Dataframeï¼Œè¡Œç´¢å¼•æ˜¯datetime.datetimeå¯¹è±¡ï¼Œåˆ—ç´¢å¼•æ˜¯å­—æ®µåç§°ã€‚
â€‹
ã€ç¤ºä¾‹1ã€‘è¿”å›ç»“æœï¼š
2017-01-03 09:30:00 - INFO
æ”¶ç›˜ä»·ï¼š        000001.SZ  000002.SZ
2016-12-19       9.20      21.10
2016-12-20       9.11      20.33
2016-12-21       9.16      20.48
2016-12-22       9.14      20.61
2016-12-23       9.08      20.30
2016-12-26       9.12      20.65
2016-12-27       9.08      21.42
2016-12-28       9.06      21.20
2016-12-29       9.08      20.84
2016-12-30       9.10      20.55
2017-01-03 09:30:00 - INFO
æœ€é«˜ä»·ï¼š        000001.SZ  000002.SZ
2016-12-19       9.23      22.00
2016-12-20       9.20      21.00
2016-12-21       9.16      20.70
2016-12-22       9.16      20.77
2016-12-23       9.14      20.67
2016-12-26       9.13      20.69
2016-12-27       9.13      21.98
2016-12-28       9.11      21.48
2016-12-29       9.09      21.32
2016-12-30       9.10      20.96

ã€ç¤ºä¾‹2ã€‘è¿”å›ç»“æœï¼š
2017-01-03 09:30:00 - INFO
300033.SZå¼€ç›˜ä»·ï¼š    open
2016-12-27 13:59:00  69.00
2016-12-27 14:59:00  68.50
2016-12-28 10:29:00  68.12
2016-12-28 11:29:00  68.69
2016-12-28 13:59:00  68.49
2016-12-28 14:59:00  68.55
2016-12-29 10:29:00  68.90
2016-12-29 11:29:00  68.81
2016-12-29 13:59:00  70.20
2016-12-29 14:59:00  70.11
2017-01-03 09:30:00 - INFO
600519.SHå¼€ç›˜ä»·ï¼š    open
2016-12-27 13:59:00  328.30
2016-12-27 14:59:00  326.55
2016-12-28 10:29:00  326.99
2016-12-28 11:29:00  326.00
2016-12-28 13:59:00  325.19
2016-12-28 14:59:00  325.40
2016-12-29 10:29:00  324.01
2016-12-29 11:29:00  323.70
2016-12-29 13:59:00  325.80
2016-12-29 14:59:00  325.80
â€‹

#### è·å–æœŸè´§å†å²è¡Œæƒ…ï¼šhistory_future

- ğŸ”§ä½œç”¨ï¼š

è·å–æœŸè´§å¤šå±æ€§çš„å†å²è¡Œæƒ…æ•°æ®,ä»…å¯åœ¨ç­–ç•¥APIå†…ä½¿ç”¨

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

history_future(
    symbol_list,
    fields,
    bar_count, 
    fre_step,
    is_panel=0
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol_list:stræˆ–listï¼Œæ ‡çš„ä»£ç ,å–å•ä¸ªåˆçº¦æ•°æ®æ—¶å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²ï¼Œè‹¥éœ€è¦å–å¤šä¸ªåˆçº¦ï¼Œéœ€ä¼ å…¥åˆ—è¡¨
fields:list,æ•°æ®å­—æ®µ,æ”¯æŒå­—æ®µå¯å‚è€ƒæœŸè´§æ—¥è¡Œæƒ…æ•°æ®ã€æœŸè´§åˆ†é’Ÿè¡Œæƒ…æ•°æ®
bar_count:å†å²é•¿åº¦ï¼Œä¾‹å¦‚ bar_count = 5ï¼Œè¡¨ç¤ºè·å–è¿‡å»5ä¸ªæ—¶é—´æ­¥é•¿çš„å†å²æ•°æ®
fre_step:æ—¶é—´æ­¥é•¿'Xd'/'Xm',Xå¿…é¡»ä¸ºæ­£æ•´æ•°ï¼Œfre_step = '1d'è¡¨ç¤ºæ—¶é—´æ­¥é•¿ä¸º1å¤©

å½“Xä¸ç­‰äº1æ—¶ï¼Œfieldä»…æ”¯æŒ'open','high','low','close','volume','turnover'è¿™å‡ ä¸ªå­—æ®µ

is_panel:è¿”å›æ•°æ®æ ¼å¼æ˜¯å¦ä¸ºpanelï¼Œé»˜è®¤ is_panel = 0

is_panel = 0: è¿”å› dictå¯¹è±¡ï¼Œå…¶keyæ˜¯symbolå³è¯åˆ¸ä»£ç ã€å€¼æ˜¯ pandas.Dataframeï¼Œè¡Œç´¢å¼•æ˜¯ datetime.datetimeå¯¹è±¡ï¼Œåˆ—ç´¢å¼•æ˜¯å­—æ®µåç§°
is_panel = 1: è¿”å› Panelå¯¹è±¡ï¼Œkeyä¸ºfiledså­—æ®µã€‚Panelä¸º pandas.DataFrameçš„ä¸‰ç»´ç»“æ„ï¼Œé€‰å®šå­—æ®µåè¾“å‡ºçš„ä¾¿æ˜¯ pandas.DataFrameå¯¹è±¡

- â—æ³¨æ„äº‹é¡¹ï¼š

ç”±äºç­–ç•¥æ¡†æ¶çš„è¿è¡Œæœºåˆ¶ï¼Œå–æ—¥é¢‘å†å²è¡Œæƒ…æ—¶ï¼Œä¸åŒ…å«å½“å‰barçš„æ•°æ®ï¼›å–åˆ†é’Ÿé¢‘å†å²è¡Œæƒ…ï¼ŒåŒ…å«å½“å‰baræ•°æ®

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾å®šæœŸè´§å“ç§ä»£ç 
    context.symbol = ['RB9999']

def handle_bar(context,bar_dict):
    price=history_future(context.symbol, ['close','high'], 10, '1d', is_panel=0)
    log.info(price)
â€‹

#### è·å–å†å²tickè¡Œæƒ…å¿«ç…§ï¼šhistory_ticks

- ğŸ”§ä½œç”¨ï¼š

è·å–å†å²tickè¡Œæƒ…å¿«ç…§æ•°æ®,ä»…å¯åœ¨ç­–ç•¥APIå†…ä½¿ç”¨

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

history_ticks(
    symbol_list,
    fields,
    bar_count, 
    is_panel=0
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol_list:stræˆ–listï¼Œæ ‡çš„ä»£ç ,å–å•ä¸ªåˆçº¦æ•°æ®æ—¶å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²ï¼Œè‹¥éœ€è¦å–å¤šä¸ªåˆçº¦ï¼Œéœ€ä¼ å…¥åˆ—è¡¨
fields:list,æ•°æ®å­—æ®µ,æ”¯æŒå­—æ®µå¯å‚è€ƒå†å²è¡Œæƒ…å¿«ç…§æ•°æ®
bar_count:å†å²é•¿åº¦ï¼Œä¾‹å¦‚ bar_count = 5ï¼Œè¡¨ç¤ºè·å–è¿‡å»5ä¸ªæ—¶é—´æ­¥é•¿çš„å†å²æ•°æ®
is_panel:è¿”å›æ•°æ®æ ¼å¼æ˜¯å¦ä¸ºpanelï¼Œé»˜è®¤ is_panel = 0

is_panel = 0: è¿”å› dictå¯¹è±¡ï¼Œå…¶keyæ˜¯symbolå³è¯åˆ¸ä»£ç ã€å€¼æ˜¯ pandas.Dataframeï¼Œè¡Œç´¢å¼•æ˜¯ datetime.datetimeå¯¹è±¡ï¼Œåˆ—ç´¢å¼•æ˜¯å­—æ®µåç§°
is_panel = 1: è¿”å› Panelå¯¹è±¡ï¼Œkeyä¸ºfiledså­—æ®µã€‚Panelä¸º pandas.DataFrameçš„ä¸‰ç»´ç»“æ„ï¼Œé€‰å®šå­—æ®µåè¾“å‡ºçš„ä¾¿æ˜¯ pandas.DataFrameå¯¹è±¡

- â—æ³¨æ„äº‹é¡¹ï¼š

åªèƒ½åœ¨tickçº§ç­–ç•¥ä¸­ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    #è®¾å®šæ ‡çš„ä»£ç 
    context.symbol = ['000001.SZ']
    subscribe(context.symbol)

def handle_tick(context,tick):
    price=history_ticks(context.symbol, ['open','prev_close'], 10, is_panel=0)
    log.info(price)
â€‹

### äº¤æ˜“å‡½æ•°

#### è‚¡ç¥¨

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®æ•°é‡ä¸‹å•ï¼šorder

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order(id_or_ins, amount, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®æ•°é‡ä¸‹å•

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
amountï¼šä¸‹å•æ•°é‡ï¼Œintï¼Œè´Ÿæ•°ä¸ºå–å‡º
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨æ—¥å¿—ä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

ä¸‹å•æ•°é‡ä¸º0æ—¶ï¼Œä¼šåœ¨æ—¥å¿—ä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #å¼€ä»“ä¹°å…¥1æ‰‹æ²ªæ·±300ETF
    order(g.index, 100,price=2.8)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®é‡‘é¢ä¸‹å•ï¼šorder_value

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_value(id_or_ins, cash_amount, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®é‡‘é¢ä¸‹å•

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
cash_amountï¼šä¸‹å•é‡‘é¢ï¼Œfloatï¼Œè´Ÿæ•°ä¸ºå–å‡º
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨logä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #å¼€ä»“ä¹°å…¥10ä¸‡å…ƒæ²ªæ·±300ETF
    order_value(g.index,100000,price=2.8)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®æ¯”ä¾‹ä¸‹å•ï¼šorder_percent

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_percent(id_or_ins, percent, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®å½“å‰æ€»èµ„äº§æ¯”ä¾‹ç¡®å®šä¸‹å•é‡‘é¢

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
percentï¼šä¸‹å•æ¯”ä¾‹ï¼Œfloatï¼Œè´Ÿæ•°ä¸ºå–å‡º
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat
styleï¼šLimitOrderå¯¹è±¡æˆ–MarketOrderå¯¹è±¡

LimitOrderå¯¹è±¡ï¼šé™ä»·å•ï¼Œæ˜¯ä¸€ç§ä»¥ç­‰åŒæˆ–ä½æ–¼æŒ‡å®šä»·æ ¼ä¹°è¿›ç›¸åº”æ•°é‡è‚¡ç¥¨çš„å§”æ‰˜å•
MarketOrderå¯¹è±¡ï¼šå¸‚ä»·å•ï¼Œä»¥å¸‚åœºä»·æ ¼ä¹°è¿›æˆ–å–å‡ºè‚¡ç¥¨çš„å§”æ‰˜å•

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨logä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #å¼€ä»“ä¹°å…¥1æˆä»“ä½çš„æ²ªæ·±300ETF
    order_percent(g.index,0.1,price=2.8)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®ç›®æ ‡æŒä»“ä¸‹å•ï¼šorder_target

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_target(id_or_ins, amount, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®ç›®æ ‡æŒä»“æ•°é‡ç¡®å®šä¸‹å•æ•°é‡

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
amountï¼šç›®æ ‡æŒä»“æ•°é‡ï¼Œint
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨logä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #è°ƒä»“è‡³æŒæœ‰1000ä»½æ²ªæ·±300ETF
    order_target(g.index,1000,price=2.8)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®ç›®æ ‡æŒæœ‰é‡‘é¢ä¸‹å•ï¼šorder_target_value

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_target_value(id_or_ins, cash_amount, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®ç›®æ ‡æŒæœ‰çš„é‡‘é¢ç¡®å®šä¸‹å•æ•°é‡

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
cash_amountï¼šç›®æ ‡æŒä»“é‡‘é¢ï¼Œfloat
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨logä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #è°ƒä»“è‡³æŒæœ‰100000å…ƒå¸‚å€¼æ²ªæ·±300ETF
    order_target_value(g.index,100000,price=2.8)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®ç›®æ ‡æŒä»“æ¯”ä¾‹ä¸‹å•ï¼šorder_target_percent

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_target_percent(id_or_ins, percent, price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°,æ ¹æ®ç›®æ ‡æŒä»“æ¯”ä¾‹ç¡®å®šä¸‹å•æ•°é‡

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

id_or_insï¼šåˆçº¦ä»£ç ï¼Œstr
percentï¼šç›®æ ‡æŒä»“æ¯”ä¾‹ï¼Œfloat
priceï¼šé™ä»·å•ä»·æ ¼ä¸Šç•Œï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸‹å•å¤±è´¥å¯èƒ½ç”±äºå¦‚ä¸‹åŸå› 

æ ‡çš„ä¸å­˜åœ¨
å¯ç”¨èµ„é‡‘ä¸è¶³æˆ–å¯ç”¨æŒä»“ä¸è¶³

ä¸‹å•è®¾ç½®å’Œå®é™…ä¸‹å•å­˜åœ¨å·®å¼‚ï¼Œä¼šåœ¨logä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯

ä¹°å…¥è‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°å½“å‰è´¦æˆ·å¯ç”¨èµ„é‡‘çš„é™åˆ¶
å–å‡ºè‚¡ç¥¨æ—¶ï¼Œä¸‹å•æ•°é‡å—åˆ°æŒä»“å¯å–æ•°é‡çš„å½±å“

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨(æ²ªæ·±300ETFï¼‰   
    g.index = '510300.OF'

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    #è°ƒä»“è‡³æŒæœ‰1æˆä»“ä½æ²ªæ·±300ETF
    order_target_percent(g.index,0.1,price=2.8)
â€‹

##### è·å¾—å§”æ‰˜è¯¦æƒ…ï¼šget_orders

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_orders(order_id)

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢å‡½æ•°,ç”¨äºè·å¾—å§”æ‰˜è¯¦æƒ…ï¼Œè¿”å›orderè®¢å•å¯¹è±¡çš„åˆ—è¡¨ï¼Œè‹¥ä¸ä¼ å…¥è®¢å•idï¼Œåˆ™è¿”å›å½“å¤©æ‰€æœ‰å§”æ‰˜çš„orderè®¢å•å¯¹è±¡çš„åˆ—è¡¨

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order_id:è®¢å•ç¼–å·ï¼Œç”±ä¸‹å•å‡½æ•°è¿”å›

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ç”¨æ¥è·å–è®¢å•è¯¦æƒ…ï¼Œéšåå°†idæ”¾å…¥get_orders(id)

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    pass

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    odr_id=order('000001.SZ',200)
    log.info(get_orders(odr_id))
â€‹

##### è·å–å½“æ—¥æ‰€æœ‰æœªå®Œæˆå§”æ‰˜è¯¦æƒ…ï¼šget_open_orders

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_open_orders(order_id)

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢å‡½æ•°,ç”¨äºè·å–å½“æ—¥æ‰€æœ‰æœªå®Œæˆå§”æ‰˜è¯¦æƒ…ï¼Œè¿”å›orderè®¢å•å¯¹è±¡çš„listï¼Œè‹¥ä¼ å…¥è®¢å•idï¼Œåˆ™è¿”å›å¯¹åº”å§”æ‰˜çš„orderè®¢å•å¯¹è±¡

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order_id:è®¢å•ç¼–å·ï¼Œç”±ä¸‹å•å‡½æ•°è¿”å›

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸€èˆ¬å›æµ‹æ—¶ï¼Œä¸‹å•éƒ½æ˜¯å…¨éƒ¨å®Œå…¨çš„ï¼Œå› æ­¤è¯¥å‡½æ•°é€‚åˆç”¨äºæ¨¡æ‹Ÿäº¤æ˜“/ä»¿çœŸäº¤æ˜“ä¸­

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    pass

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    odr_id_1=order('000001.SZ',200)
    odr_id_2=order('600519.SH',200)
    log.info(get_open_orders())
â€‹

##### è·å–å½“æ—¥æ‰€æœ‰æˆäº¤è¯¦æƒ…ï¼šget_tradelogs

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_tradelogs()

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢å‡½æ•°,ç”¨äºè·å–å½“æ—¥æ‰€æœ‰æˆäº¤è¯¦æƒ…ï¼Œè¿”å›tradeæˆäº¤å¯¹è±¡çš„list

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    pass

#è®¾ç½®ä¹°å–æ¡ä»¶ï¼Œæ¯ä¸ªäº¤æ˜“é¢‘ç‡ï¼ˆæ—¥/åˆ†é’Ÿï¼‰è°ƒç”¨ä¸€æ¬¡   
def handle_bar(context, bar_dict):
    odr_id_1=order('000001.SZ',200)
    odr_id_2=order('600519.SH',200)
    log.info(get_tradelogs())
â€‹

##### æ’¤é”€æœªå®Œæˆå§”æ‰˜è®¢å•ï¼šcancel_order

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
cancel_order(order)

- ğŸ”§ä½œç”¨ï¼š

æ’¤å•å‡½æ•°,ç”¨äºæ’¤é”€æœªå®Œæˆå§”æ‰˜è®¢å•

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order:å¯ä»¥æ˜¯orderè®¢å•å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯è®¢å•id

- â—æ³¨æ„äº‹é¡¹ï¼š

è‹¥è®¢å•å¤„äºä¸å¯æ’¤é”€çš„çŠ¶æ€ï¼Œæ­¤å‡½æ•°ä¼šæŠ¥é”™ï¼Œå¯é…åˆtryå…³é”®å­—ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    pass

def handle_bar(context,bar_dict):
    # ä»¥å¼€ç›˜ä»·ä¹°å…¥å¹³å®‰é“¶è¡Œè‚¡ç¥¨1000è‚¡  
    id=order('000001.SZ', 1000)
    # è·å–æ‰€æœ‰æœªå®Œæˆè®¢å•
    orders = get_open_orders(id)
    #å¦‚æœæœ‰æœªå®Œæˆçš„åˆ™ordersé•¿åº¦å¿…å®šå¤§äº0ï¼Œå¦åˆ™å°±æ˜¯å·²ç»å®Œæˆ.
    if len(orders)>0:
        #å–æ¶ˆæœªå®Œæˆè®¢å•
        cancel_order(orders)
â€‹

##### æ’¤é”€æ‰€æœ‰æœªå®Œæˆå§”æ‰˜è®¢å•ï¼šcancel_order_all

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
cancel_order_all()

- ğŸ”§ä½œç”¨ï¼š

æ’¤å•å‡½æ•°,ç”¨äºæ’¤é”€æ‰€æœ‰æœªå®Œæˆå§”æ‰˜è®¢å•

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    pass

def handle_bar(context,bar_dict):
    # ä»¥å¼€ç›˜ä»·ä¹°å…¥å¹³å®‰é“¶è¡Œè‚¡ç¥¨1000è‚¡  
    id=order('000001.SZ', 1000)
    # è·å–æ‰€æœ‰æœªå®Œæˆè®¢å•
    orders = get_open_orders(id)
    #å¦‚æœæœ‰æœªå®Œæˆçš„åˆ™ordersé•¿åº¦å¿…å®šå¤§äº0ï¼Œå¦åˆ™å°±æ˜¯å·²ç»å®Œæˆ.
    if len(orders)>0:
        #å–æ¶ˆæ‰€æœ‰æœªå®Œæˆè®¢å•
        cancel_order_all()
â€‹

#### æœŸè´§

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®æ•°é‡ä¸‹å•ï¼šorder_future

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_future(symbol,amount,offset_flag,order_type,limit_price=None)

- ğŸ”§ä½œç”¨ï¼š

ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®æ‰‹æ•°ä¸‹å•è´­ä¹°æœŸè´§åˆçº¦

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbolï¼šåˆçº¦ä»£ç ï¼Œstr
amountï¼šå§”æ‰˜æ•°é‡ï¼ˆæ‰‹ï¼‰ï¼Œfloat
offset_flagï¼šå¼€å¹³ä»“æ ‡è¯†ï¼Œstrï¼Œ'open'ä¸ºå¼€ä»“ï¼Œ'close'ä¸ºå¹³ä»“
order_typeï¼šå¤šç©ºä»“æ ‡è¯†ï¼Œstrï¼Œ'long'ä¸ºå¤šä»“ï¼Œ'short'ä¸ºç©ºä»“
limit_priceï¼šé™å®šä»·æ ¼ï¼Œfloatï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºå¸‚ä»·å³æ—¶å•ï¼Œå¦åˆ™å§”æ‰˜å•å˜ä¸ºé™ä»·å³æ—¶å•

- ğŸ“ç¤ºä¾‹ï¼š

#åˆå§‹åŒ–è´¦æˆ·  
def init(context):  
    set_subportfolios([{'type':'FUTURE','cash':10000000}])
    #è®¾å®šæœŸè´§å“ç§ä»£ç   
    context.symbol = 'RB1812'  

def handle_bar(context,bar_dict):  
    #ä¸‹å•10æ‰‹èºçº¹é’¢1812åˆçº¦ï¼Œå¼€å¤šä»“
    order_future(context.symbol,10,"open","long",limit_price=None)
â€‹

##### ä¸‹å•å‡½æ•°ï¼Œå¹³ä»Šä»“å•ï¼šorder_close_today

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_close_today(symbol,amount,order_type,limit_price=None)

- ğŸ”§ä½œç”¨ï¼š

å¹³ä»Šä»“å•ï¼Œä»…ä»…èƒ½å¤Ÿå¹³æ‰ä»Šå¤©æ–°å¼€çš„ä»“ä½

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbolï¼šåˆçº¦ä»£ç ï¼Œstr
amountï¼šå§”æ‰˜æ•°é‡ï¼ˆæ‰‹ï¼‰ï¼Œfloat
order_typeï¼šå¤šç©ºä»“æ ‡è¯†ï¼Œstrï¼Œ'long'ä¸ºå¤šä»“ï¼Œ'short'ä¸ºç©ºä»“
limit_priceï¼šé™å®šä»·æ ¼ï¼Œfloatï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºå¸‚ä»·å³æ—¶å•ï¼Œå¦åˆ™å§”æ‰˜å•å˜ä¸ºé™ä»·å³æ—¶å•

- ğŸ“ç¤ºä¾‹ï¼š

#åˆå§‹åŒ–è´¦æˆ·  
def init(context):  
    set_subportfolios([{'type':'FUTURE','cash':10000000}])
    #è®¾å®šæœŸè´§å“ç§ä»£ç   
    context.symbol=    'RB1812'  

def handle_bar(context,bar_dict):  
    #ä¸‹å•10æ‰‹èºçº¹é’¢1812åˆçº¦ï¼Œå¼€å¤šä»“
    order_future(context.symbol,10,"open","long")
    #å¹³ä»Šä»“5æ‰‹èºçº¹é’¢1812åˆçº¦
    order_close_today(context.symbol, 5,'long',limit_price=None)
â€‹

#### æœŸæƒ

##### ä¸‹å•å‡½æ•°ï¼Œæ ¹æ®æ•°é‡ä¸‹å•ï¼šorder_option

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_option(order_book_id, amount, side, position_effect, price=None)

- ğŸ”§ä½œç”¨ï¼š

æœŸæƒä¸‹å•å‡½æ•°

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order_book_idï¼šæœŸæƒä»£ç ï¼Œstr
amountï¼šå§”æ‰˜æ•°é‡ï¼ˆæ‰‹ï¼‰ï¼Œfloat
sideï¼šæ–¹å‘ï¼Œstrï¼Œ'buy'ä¸ºå¤šä»“ï¼Œ'sell'ä¸ºç©ºä»“
position_effectï¼šå¼€å¹³ä»“ï¼Œstrï¼Œ'open'ä¸ºå¼€ä»“ï¼Œ'close'ä¸ºå¹³ä»“
priceï¼šé™å®šä»·æ ¼ï¼Œfloatï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºå¸‚ä»·å³æ—¶å•ï¼Œå¦åˆ™å§”æ‰˜å•å˜ä¸ºé™ä»·å³æ—¶å•

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    set_subportfolios([{'cash': 100000, 'type': 'option'}])
    set_option_commission(5)        # é»˜è®¤ä¹Ÿæ˜¯5
    g.ins= '10001485.SH'            # çœ‹è·Œï¼Œ20181128è¡Œæƒä»·2.7
    g.day = 1

def handle_bar(context, bar_dict):
    if g.day == 1:
        order_option(g.ins, 10, 'buy', 'open')
    elif g.day == 2:
        order_option(g.ins, 10, 'sell', 'close')
    g.day += 1
â€‹

#### åœºå¤–åŸºé‡‘

##### ç”³è´­åŸºé‡‘ï¼šorder_fund

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
order_fund(order_book_id, value)

- ğŸ”§ä½œç”¨ï¼š

åœ¨åœºå¤–åŸºé‡‘APIä¸­ï¼Œç”¨äºç”³è´­åŸºé‡‘

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order_book_idï¼šåŸºé‡‘ä»£ç ï¼Œstr
valueï¼šä¸‹å•é‡‘é¢ï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

åªæ”¯æŒé‡‘é¢ä¸‹å•
ä¸‹å•æˆåŠŸè¿”å›order_idï¼Œä¸‹å•å¤±è´¥è¿”å›None

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    # è®¾ç½®3ä¸ªå­è´¦æˆ·ï¼Œè‚¡ç¥¨ï¼ŒæœŸè´§ï¼Œåœºå¤–åŸºé‡‘åˆå§‹èµ„é‡‘éƒ½ä¸º100000
    set_subportfolios([{'cash': 100000, 'type': 'fund'}, {'cash': 100000, 'type': 'future'}, {'cash': 100000, 'type': 'stock'}])
    context.ins = '000717.OF'

def handle_bar(context, bar_dict):
    order_id = order_fund(context.ins, 1000)
    log.info('ç”³è´­', order_id)
â€‹

##### èµå›åŸºé‡‘ï¼šredeem_fund

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
redeem_fund(order_book_id, amount)

- ğŸ”§ä½œç”¨ï¼š

åœ¨åœºå¤–åŸºé‡‘APIä¸­ï¼Œç”¨äºèµå›åŸºé‡‘

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

order_book_idï¼šåŸºé‡‘ä»£ç ï¼Œstr
amountï¼šä¸‹å•ä»½é¢ï¼Œfloat

- â—æ³¨æ„äº‹é¡¹ï¼š

åªæ”¯æŒä»½é¢ä¸‹å•
ä¸‹å•æˆåŠŸè¿”å›order_idï¼Œä¸‹å•å¤±è´¥è¿”å›None

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    # è®¾ç½®3ä¸ªå­è´¦æˆ·ï¼Œè‚¡ç¥¨ï¼ŒæœŸè´§ï¼Œåœºå¤–åŸºé‡‘åˆå§‹èµ„é‡‘éƒ½ä¸º100000
    set_subportfolios([{'cash': 100000, 'type': 'fund'}, {'cash': 100000, 'type': 'future'}, {'cash': 100000, 'type': 'stock'}])
    context.ins = '000717.OF'

def handle_bar(context, bar_dict):
    order_id = order_fund(context.ins, 1000)
    log.info('ç”³è´­', order_id)
    order_id = redeem_fund(context.ins, 500)
    log.info('èµå›', order_id)
â€‹

### æšä¸¾å¸¸é‡

#### ORDER_STATUS - å§”æ‰˜çŠ¶æ€

| æšä¸¾å€¼ | å«ä¹‰ |
| --- | --- |
| PENDING_NEW | åˆ›å»ºä¸­ |
| ACTIVE | æœªæˆäº¤ |
| FILLED | å·²æˆäº¤ |
| REJECTED | åºŸå• |
| PENDING_CANCEL | å–æ¶ˆä¸­ |
| CANCELLED | å·²å–æ¶ˆ |

### é‡è¦å¯¹è±¡

#### contextè´¦æˆ·å¯¹è±¡

- ğŸ”§ä½œç”¨ï¼š

å…¨å±€å¯¹è±¡ï¼Œå­˜å‚¨ç­–ç•¥ä¿¡æ¯(context.run_info),è´¦æˆ·æŒä»“æ•°æ®(context.portfolio)ï¼Œä¹Ÿå¯ç”¨äºå‚¨å­˜è‡ªå®šä¹‰å…¨å±€å˜é‡ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨

- â›ºæ•°æ®ç»“æ„(æ€ç»´å¯¼å›¾å¯ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§ã€ç¼©å°ï¼Œæ‹–åŠ¨æ“ä½œ)

- â—æ³¨æ„äº‹é¡¹ï¼š

è‡ªå®šä¹‰çš„å…¨å±€å˜é‡å°½å¯èƒ½å­˜åœ¨ gä¸­è€Œä¸æ˜¯ context,é¿å…ç³»ç»Ÿå˜é‡è¢«è¦†ç›–

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    context.fired=True
    log.info(context.run_info)
    log.info(context.portfolio)
    log.info(context.fired)
  
def handle_bar(context,bar_dict):
    if context.fired:
        odr_id = order('000001.SZ',100)
        context.fired = False
        log.info(context.run_info)
        log.info(context.portfolio)
        log.info(context.fired)
  
        log.info(context.portfolio.positions) #è¾“å‡ºçœ‹èµ·æ¥åƒä¸ªåˆ—è¡¨,å®é™…ç±»ä¼¼äºå­—å…¸
        log.info(context.portfolio.stock_account.positions)
  
        log.info(context.portfolio.positions['000001.SZ'])
        log.info(context.portfolio.stock_account.positions['000001.SZ'])
â€‹
```

#### barè¡Œæƒ…æ•°æ®ï¼šbar_dictæ•°æ®å¯¹è±¡

- ğŸ”§ä½œç”¨ï¼š

å…¨å±€å¯¹è±¡ï¼Œç”¨äºå‚¨å­˜å½“å‰æ—¶é—´çš„barè¡Œæƒ…æ•°æ®ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨

- â›ºæ•°æ®ç»“æ„(æ€ç»´å¯¼å›¾å¯ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§ã€ç¼©å°ï¼Œæ‹–åŠ¨æ“ä½œ) æ—¥é¢‘:

- â—æ³¨æ„äº‹é¡¹ï¼š

ä½¿ç”¨è‚¡ç¥¨APIæ—¶ï¼Œæ— éœ€è®¢é˜…
ä½¿ç”¨æœŸè´§APIæ—¶ï¼Œéœ€è¦ä½¿ç”¨ subscribeå‡½æ•°è®¢é˜…

- ğŸ“ç¤ºä¾‹ï¼š

```
span
â€‹
```

#### å½“å‰barè¡Œæƒ…æ•°æ®ï¼šget_current

- ğŸ”§ä½œç”¨ï¼š

- è·å–å½“å‰barçš„è¡Œæƒ…æ•°æ®ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨ã€‚

- â—æ³¨æ„äº‹é¡¹ï¼š

- åœ¨ç ”ç©¶ç¯å¢ƒï¼Œä½¿ç”¨get_currentä»…æš‚æ—¶ä¸get_last_tickæ•ˆæœç­‰åŒï¼Œå¹¶æŠ¥é”™WARNæç¤ºæ›¿æ¢ã€‚å°†ä¸‹ä¸€ç‰ˆæœ¬å½»åº•åˆ é™¤ç ”ç©¶ç¯å¢ƒçš„get_currentï¼Œè¯·æ³¨æ„æ›¿æ¢ã€‚

- ğŸ“ç¤ºä¾‹ï¼š

```
def handle_bar(context,bar_dict):
    log.info(get_current(['300033.SZ','600000.SH']))
â€‹
```

#### è®¢å•å¯¹è±¡ï¼šorder

- ğŸ”§ä½œç”¨ï¼š

on_orderå‡½æ•°æ¨é€,æˆ–ä½¿ç”¨get_order/get_orders/get_open_orderså‡½æ•°æŸ¥è¯¢ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨

- â›ºæ•°æ®ç»“æ„(æ€ç»´å¯¼å›¾å¯ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§ã€ç¼©å°ï¼Œæ‹–åŠ¨æ“ä½œ) æ—¥é¢‘:

- â—æ³¨æ„äº‹é¡¹ï¼š

å¯ç»“åˆå§”æ‰˜æ•°é‡ã€æˆäº¤æ•°é‡ã€å§”æ‰˜çŠ¶æ€æ¥åˆ¤æ–­åŒºåˆ†æœªæˆäº¤ã€éƒ¨åˆ†æˆäº¤ã€å…¨æ’¤ã€éƒ¨æˆéƒ¨æ’¤çš„çŠ¶æ€

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    g.fired = True

def handle_bar(context,bar_dict):
    if g.fired:
        odr_id = order('000001.SZ',100)
        print(get_order(odr_id))
        g.fired=False

def on_order(context,odr):
    print(odr)
â€‹
```

#### æˆäº¤å¯¹è±¡ï¼štrade

- ğŸ”§ä½œç”¨ï¼š

on_tradeå‡½æ•°æ¨é€,æˆ–ä½¿ç”¨get_tradelogså‡½æ•°æŸ¥è¯¢ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨

- â›ºæ•°æ®ç»“æ„(æ€ç»´å¯¼å›¾å¯ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§ã€ç¼©å°ï¼Œæ‹–åŠ¨æ“ä½œ) æ—¥é¢‘:

- â—æ³¨æ„äº‹é¡¹ï¼š

æœ‰æˆäº¤æ—¶å°±ä¼šæ¨é€ï¼Œä¸ä»£è¡¨è®¢å•å®Œå…¨æˆäº¤

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    g.fired = True

def handle_bar(context,bar_dict):
    if g.fired:
        odr_id = order('000001.SZ',100)
        print(get_tradelogs())
        g.fired=False

def on_trade(context,trade):
    print(trade)
â€‹
```

#### å…¨å±€å˜é‡å¯¹è±¡ï¼šg

- ğŸ”§ä½œç”¨ï¼š

å…¨å±€å¯¹è±¡ï¼Œç”¨äºå‚¨å­˜å…¨å±€å˜é‡ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨

- â—æ³¨æ„äº‹é¡¹ï¼š

è‡ªå®šä¹‰çš„å…¨å±€å˜é‡å°½å¯èƒ½å­˜åœ¨ gä¸­è€Œä¸æ˜¯ context,é¿å…ç³»ç»Ÿå˜é‡è¢«è¦†ç›–

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):   
    #è®¾ç½®è¦äº¤æ˜“çš„è‚¡ç¥¨ 
    g.contract = '300033.SZ'

def handle_bar(context, bar_dict):
    order(g.contract, 1000)
â€‹

### è¾…åŠ©å‡½æ•°

#### æ—¥å¿—å‡½æ•°ï¼šlog

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

log.info(content)
log.warn(content)
log.error(content)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

contentï¼šéœ€è¦æ‰“å°è¾“å‡ºçš„æ—¥å¿—å†…å®¹ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªå¯¹è±¡

- ğŸ”§ä½œç”¨ï¼š

log.infoï¼Œlog.warnï¼Œlog.erroræ˜¯ä¸‰ç§ä¸åŒçº§åˆ«çš„æ‰“å°å‡½æ•°,çº§åˆ«æ’åº(å…ˆå)ï¼šerror>warn>info

- â—æ³¨æ„äº‹é¡¹ï¼š

log.erroræ˜¯ä¸€ä¸ªæ‰“å°è¾“å‡ºç»“æœå‡½æ•°,å½“è¯¥å‡½æ•°æ‰§è¡Œå,æ•´ä¸ªç­–ç•¥ä¼šç»ˆæ­¢å›æµ‹è¿è¡Œ
éœ€è¦å°†æ—¥å¿—å¦å­˜ä¸ºæ–‡ä»¶æŒä¹…åŒ–çš„è¯å¯ä»¥é€šè¿‡set_log_levelå‡½æ•°è¿›è¡Œè®¾ç½®
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

def init(context):
    pass

def handle_bar(context,bar_dict):
    # è·å¾—å½“å‰Baræ—¶é—´
    time =get_datetime()
    log.info('ç›®å‰Baræ—¶é—´:'+str(time))
â€‹

#### ç”»å›¾å‡½æ•°ï¼šrecord

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

record(**kwargs)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

å¯å˜å‚æ•°ï¼škeyä¸ºæ›²çº¿åç§°ï¼Œvalueä¸ºå½“å‰æ—¥æœŸä¸‹æ›²çº¿å¯¹åº”çš„å€¼

- ğŸ”§ä½œç”¨ï¼š

ç”»å›¾å‡½æ•°ï¼Œæ ¹æ®ç­–ç•¥éœ€æ±‚ï¼Œè‡ªå®šä¹‰ç”»å›¾

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¯ä»¥ç”»å‡ºå¤šæ¡keyçº¿å›¾èµ°åŠ¿ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€æ¡

- ğŸ“ç¤ºä¾‹ï¼š

#ç”»å‡ºå¹³å®‰é“¶è¡Œçš„5.10.20æ—¥å‡çº¿èµ°åŠ¿å›¾.
def init(context):
    pass

def handle_bar(context,bar_dict):
    value = history('000001.SZ', ['close'], 20, '1d', True, fq='pre')
    MA5=value['close'].iloc[-5:].mean()
    MA10=value['close'].iloc[-10:].mean()
    MA20=value['close'].iloc[-20:].mean()
    record(MA5=MA5, MA10=MA10,MA20=MA20)
â€‹

#### æ€§èƒ½åˆ†æå‡½æ•°ï¼šenable_profile

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

enable_profile(func_list)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

func_listï¼šæ‰€éœ€åˆ†æå‡½æ•°çš„åç§°,ä¸€èˆ¬æ ¹æ®å®é™…éœ€æ±‚å¡«å†™éœ€è¦åˆ†æçš„å‡½æ•°å,ä¸å¡«é»˜è®¤åˆ†ææ‰€æœ‰å‡½æ•°

- ğŸ”§ä½œç”¨ï¼š

æ€§èƒ½åˆ†æå‡½æ•°,è·å–ç­–ç•¥ä¸­å„ä¸ªå‡½æ•°çš„è¿è¡Œæ—¶é—´

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åœ¨ç­–ç•¥æ¡†æ¶å‡½æ•°ä¹‹å¤–æ‰§è¡Œ
æ€§èƒ½åˆ†æç»“æœå†æ—¥å¿—çš„æœ€åéƒ¨åˆ†æ˜¾ç¤º
func_listå‚æ•°å¦‚æœä¸å¡«å†™ï¼Œåˆ™é»˜è®¤ä¸ºåˆ†ææ‰€æœ‰å‡½æ•°

- ğŸ“ç¤ºä¾‹ï¼š

```
#å°†åˆå§‹åŒå‡çº¿ç­–ç•¥è¿›è¡Œå‡½æ•°æ€§èƒ½åˆ†æ.
#åˆå§‹åŒ–è´¦æˆ·
def init(context):
    context.security = '600519.SH'

def handle_bar(context,bar_dict):
    close = history(context.security, ['close'], 20, '1d')
    MA5 = close.values[-5:].mean()
    MA20 = close.values.mean()
    if MA5 > MA20:
        order_target_percent(context.security,1)
    if MA5 < MA20:
        order_target(context.security,0)

enable_profile()
â€‹
```

## å·¥å…·å‡½æ•°

### è‚¡ç¥¨ä»£ç æ ¼å¼è½¬æ¢ï¼šnormalize_symbol

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

normalize_symbol(str,type)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

strï¼šè‚¡ç¥¨ã€åŸºé‡‘ä»£ç çš„å­—ç¬¦ä¸²æ ¼å¼
typeï¼šè½¬æ¢ä»£ç ç±»å‹ï¼Œ'stock'ä»£è¡¨è‚¡ç¥¨,'ota'ä»£è¡¨åŸºé‡‘,é»˜è®¤ä¸º 'stock'

- ğŸ”§ä½œç”¨ï¼š

ä»£ç è½¬æ¢å‡½æ•°ï¼Œå¯ä»¥å°†å…¶ä»–å½¢å¼çš„è‚¡ç¥¨ï¼ˆåŸºé‡‘ï¼‰ä»£ç è½¬æ¢ä¸ºSuperMindçš„è‚¡ç¥¨ï¼ˆåŸºé‡‘ï¼‰ä»£ç å½¢å¼

- â—æ³¨æ„äº‹é¡¹ï¼š

å…¶ä»–å½¢å¼çš„è‚¡ç¥¨ã€åŸºé‡‘ä»£ç ,å…¶æ ¼å¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ ¼å¼,ä¾‹å¦‚'300033'
ä¸èƒ½è¾“å…¥æ–‡å­—ï¼Œå¿…é¡»æ˜¯ä»£ç ï¼Œå¯ä»¥æ˜¯è‚¡ç¥¨ä¹Ÿå¯ä»¥æ˜¯åŸºé‡‘
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
#å°†åˆå§‹åŒå‡çº¿ç­–ç•¥è¿›è¡Œå‡½æ•°æ€§èƒ½åˆ†æ.
#åˆå§‹åŒ–è´¦æˆ·
def init(context):
    context.security = '300033'

def handle_bar(context,bar_dict):
    log.info(normalize_symbol(context.security,'stock'))
â€‹
```

### ä¿å­˜æ–‡ä»¶å‡½æ•°ï¼šwrite_file

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

write_file(path, content, append=False)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

pathï¼šstrï¼Œç›¸å¯¹è·¯å¾„ï¼Œç ”ç©¶ç¯å¢ƒè·¯å¾„ï¼Œä¾‹å¦‚ï¼Œ'test.txt'ä»£è¡¨åœ¨ç ”ç©¶ç¯å¢ƒæ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªtest.txtæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®
contentï¼šéœ€è¦ä¿å­˜çš„å†…å®¹ï¼Œstræ ¼å¼æˆ–è€…unicodeæ ¼å¼, å¦‚æœæ˜¯unicode, åˆ™ä¼šä½¿ç”¨UTF-8ç¼–ç å†å­˜å‚¨.å¯ä»¥æ˜¯äºŒè¿›åˆ¶å†…å®¹.stræ ¼å¼å³ä¸ºå­—ç¬¦ä¸²æ ¼å¼,ä¾‹å¦‚:'æ˜å¤©ä¼šä¸‹é›¨'
appendï¼šbool,æ˜¯å¦æ˜¯è¿½åŠ æ¨¡å¼ï¼Œå½“è·¯å¾„ä¸å˜æ—¶ï¼Œæ–°çš„å†…å®¹æ˜¯å¦è¦†ç›–æ—§çš„å†…å®¹ï¼Œé»˜è®¤ä¸ºFalse

append=True:è¯¥æ–‡ä»¶ä¸‹å†æ¬¡ä¿å­˜å†…å®¹æ˜¯ä¼šä¿ç•™ä¹‹å‰çš„æ—§å†…å®¹
append=False:è¯¥æ–‡ä»¶ä¸‹å†æ¬¡ä¿å­˜å†…å®¹æ˜¯ä¼šè¦†ç›–ä¹‹å‰çš„æ—§å†…å®¹

- ğŸ”§ä½œç”¨ï¼š

ä¿å­˜æ–‡ä»¶å‡½æ•°ï¼Œå°†å†…å®¹ä¿å­˜åˆ°ç ”ç©¶æ¨¡å—ç›®å½•ä¸­

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ä¿å­˜çš„å†…å®¹çš„æ ¼å¼å¿…é¡»è½¬åŒ–æˆstræ ¼å¼æˆ–è€…unicodeæ ¼å¼
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

#ç”¨æ™ºèƒ½é€‰è‚¡é€‰å‡ºæ²ªæ·±300è‚¡ç¥¨å‡ºæ¥åï¼Œä»¥æ–‡ä»¶å½¢å¼ä¿å­˜åˆ°æˆ‘çš„ç ”ç©¶æ–‡ä»¶ä¸­.
def init(context):
    get_iwencai('æ²ªæ·±300','stocks_list')

def handle_bar(context,bar_dict):   
    write_file('test.txt', str(context.stocks_list))
â€‹

### è¯»å–æ–‡ä»¶å‡½æ•°ï¼šread_file

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

read_file(path)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

pathï¼šstrï¼Œç›¸å¯¹è·¯å¾„ï¼Œç ”ç©¶ç¯å¢ƒæ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼Œ'test.txt'ä»£è¡¨åœ¨ç ”ç©¶ç¯å¢ƒæ ¹ç›®å½•ä¸­åä¸ºtest.txtæ–‡ä»¶

- ğŸ”§ä½œç”¨ï¼š

è¯»å–æ–‡ä»¶å‡½æ•°ï¼Œè¯»å–ç ”ç©¶ç¯å¢ƒä¸­çš„æ–‡ä»¶

- â—æ³¨æ„äº‹é¡¹ï¼š

æ–‡ä»¶ä¿å­˜åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™pathçš„æ ¼å¼å¿…é¡»æ˜¯'æ–‡ä»¶å¤¹å/æ–‡ä»¶å'
æ–‡ä»¶ä¿å­˜åœ¨æ ¹ç›®å½•ä¸‹ï¼Œåˆ™pathæ ¼å¼ä¸º:'æ–‡ä»¶å'
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    get_iwencai('æ²ªæ·±300','stocks_list')

def handle_bar(context,bar_dict):   
    write_file('test.txt', str(context.stocks_list))
    data = read_file('test.txt')
    log.info(data)
â€‹
```

### æŸ¥è¯¢ç ”ç©¶ç¯å¢ƒæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼šlist_file

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

list_file(path, isfile=None, isdir=None, abspath=True)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

pathï¼šstrï¼Œç ”ç©¶ç¯å¢ƒæ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼Œ'test'ä»£è¡¨åœ¨ç ”ç©¶ç¯å¢ƒæ ¹ç›®å½•ä¸­åä¸ºtestçš„æ–‡ä»¶å¤¹
isfile: boolï¼Œæ˜¯å¦è¿”å›æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºNone
isdirï¼šboolï¼Œæ˜¯å¦è¿”å›æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸ºNone
abspathï¼šboolï¼Œæ˜¯å¦è¿”å›ç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºTrue

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢ç ”ç©¶ç¯å¢ƒæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶

- â—æ³¨æ„äº‹é¡¹ï¼š

isfileå’Œisdiréƒ½ä¸ºNoneæ—¶ï¼Œä»£è¡¨å³è¿”å›æ–‡ä»¶ï¼Œåˆè¿”å›æ–‡ä»¶å¤¹
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    print(list_file(''))

def handle_bar(context,bar_dict):   
    pass
â€‹
```

### å¤åˆ¶/å‰ªè´´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼šcopy_file

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

copy_file(src, dst, move=False)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

srcï¼šstrï¼Œéœ€è¦æ“ä½œçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„
dst: strï¼Œç›®æ ‡è·¯å¾„(ç ”ç©¶ç¯å¢ƒ),ä¾‹å¦‚ï¼Œ'test'ä»£è¡¨åœ¨ç ”ç©¶ç¯å¢ƒæ ¹ç›®å½•ä¸­åä¸ºtestçš„æ–‡ä»¶å¤¹
moveï¼šboolï¼Œæ˜¯å¦å‰ªè´´ï¼Œé»˜è®¤ä¸ºFalse

- ğŸ”§ä½œç”¨ï¼š

å¤åˆ¶/å‰ªè´´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿ç§»å•ä¸ªæ–‡ä»¶æ—¶ï¼Œè®¾ç½®ç›®æ ‡è·¯å¾„æ—¶ä¹Ÿéœ€è¦å…·ä½“åˆ°æ–‡ä»¶å
å¯ä»¥åˆ©ç”¨æ­¤å‡½æ•°æ–°å»ºæ–‡ä»¶å¤¹ï¼šcopy_file(None,'new_folder')ï¼Œä»£è¡¨åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºåä¸ºâ€˜new_folderâ€™çš„æ–‡ä»¶å¤¹
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    write_file('test.txt','123')
    copy_file(None,'new_folder')
    copy_file('test.txt','new_folder/abc.txt',move=True)

def handle_bar(context,bar_dict):   
    pass
â€‹
```

### åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼šremove_file

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

remove_file(path, trash=True)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

pathï¼šstrï¼Œéœ€è¦åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹çš„è·¯å¾„
trash: boolï¼Œæ˜¯å¦ç§»å…¥å›æ”¶ç«™ï¼Œé»˜è®¤ä¸ºTrueï¼Œä¸ºFalseæ—¶æ„å‘³ç€å½»åº•åˆ é™¤

- ğŸ”§ä½œç”¨ï¼š

åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹

- â—æ³¨æ„äº‹é¡¹ï¼š

trash=Falseæ—¶æ„å‘³ç€å½»åº•åˆ é™¤æ–‡ä»¶ï¼Œä¸å¯æ¢å¤
ç ”ç©¶ç¯å¢ƒä¸­åŒæ ·å¯ä»¥ä½¿ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

```
def init(context):
    write_file('test.txt','123')
    remove_file('test.txt')

def handle_bar(context,bar_dict):   
    pass
â€‹
```

### æ¶ˆæ¯æ¨é€å‡½æ•°ï¼šnotify_push

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

notify_push(
    content, 
    channel='wxpusher', 
    subject='SuperMindæ¶ˆæ¯æé†’', 
    email_list=None, 
    uids=None, 
    topic_ids=None, 
    group_id=None,
    url=None,
    payload=None,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

contentï¼šéœ€è¦æ¨é€çš„æ¶ˆæ¯æ–‡æœ¬
channel: ç›®å‰æ”¯æŒå¾®ä¿¡æ¨é€ã€webhookï¼Œå‚æ•°å€¼åˆ†åˆ«ä¸º "wxpusher"ã€"webhook"
subject: æ¶ˆæ¯ä¸»é¢˜
uids: listï¼Œchannelä¸º wxpusheréœ€è¦å¡«å†™ï¼Œç”¨æˆ·çš„UIDï¼Œå…³æ³¨å…¬ä¼—å·ï¼Œç‚¹å‡»â€œæˆ‘çš„ï¼æˆ‘çš„UIDâ€è·å–ç”¨æˆ·UIDä¿¡æ¯
url: strï¼Œchannelä¸º webhookéœ€è¦å¡«å†™ï¼Œwebhookåœ°å€
payload: dictï¼Œchannelä¸º webhookéœ€è¦å¡«å†™ï¼Œæ¶ˆæ¯æ ¼å¼ï¼Œå¦‚é’‰é’‰çš„æ¶ˆæ¯æ ¼å¼ä¸º {"msgtype": "text", "text": {"content": "$content"}}ï¼Œå…¶ä¸­ $contentä¼šè¢«æ›¿æ¢ä¸º contentå‚æ•°ä¼ å…¥çš„å€¼

- ğŸ”§ä½œç”¨ï¼š

æ¶ˆæ¯æ¨é€å‡½æ•°ï¼Œåœ¨ç ”ç©¶ç¯å¢ƒã€ç­–ç•¥ç¼–è¾‘ç­‰æ¨¡å—å‡å¯ä½¿ç”¨

- â—æ³¨æ„äº‹é¡¹ï¼š

channel='wxpusher'æ—¶ï¼Œéœ€è¦å…ˆå…³æ³¨å…¬ä¼—å·ï¼š

webhookæ•™ç¨‹è§ï¼šæ¨¡æ‹Ÿä»¿çœŸ (10jqka.com.cn)

- ğŸ“ç¤ºä¾‹ï¼š

```
try:
    raise
except:
    # å¾®ä¿¡æ¨é€
    notify_push(
        'ç¨‹åºæŠ¥é”™', 
        channel='wxpusher', 
        subject='SuperMindæ¶ˆæ¯æé†’', 
        uids='XXXXXX',
    )
    # é’‰é’‰webhookæ¨é€
    notify_push(
        'ç¨‹åºæŠ¥é”™', 
        channel='webhook',   
        url='XXXXXX',
        payload={"msgtype": "text", "text": {"content": "$content"}},
    )
â€‹
```

### è‡ªé€‰æ¿å—ï¼šcustom_sector

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

custom_sector(name=None, action='query', symbol=None, rename=None)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

nameï¼šstrï¼Œæ¿å—åç§°
action: strï¼Œinsert - æ–°å»ºnameçš„æ¿å—ï¼Œupdate - æ›´æ–°æŒ‡å®šæ¿å—çš„è‚¡ç¥¨åˆ—è¡¨æˆ–é‡å‘½åï¼Œappend - åœ¨æŒ‡å®šæ¿å—ä¸­æ–°å¢è‚¡ç¥¨ï¼Œpop - ç§»é™¤æŒ‡å®šæ¿å—å†…çš„ä¸ªåˆ«è‚¡ç¥¨ï¼Œremove - ç§»é™¤æŒ‡å®šæ¿å—
symbolï¼šlistï¼Œè‚¡ç¥¨åˆ—è¡¨
rename: strï¼Œé‡å‘½åæ¿å—åç§°

- ğŸ”§ä½œç”¨ï¼š

è¯»å–æˆ–ä¿®æ”¹è‡ªé€‰æ¿å—

- ğŸ“ç¤ºä¾‹ï¼š

```
custom_sector() # è¿”å›æ‰€æœ‰æ¿å—çš„dataframe

custom_sector('æ¿å—1') # è¿”å› æ¿å—1 çš„å±æ€§å’Œè‚¡ç¥¨

custom_sector('æ¿å—1', 'insert', ['000001.SZ']) # æ–°å»ºæ¿å—1çš„è‚¡ç¥¨åˆ—è¡¨

custom_sector('æ¿å—1', 'update', ['000001.SZ'], 'æ–°åå­—') # æ›´æ–°æ¿å—1çš„è‚¡ç¥¨åˆ—è¡¨æˆ–åå­—

custom_sector('æ¿å—1', 'append', ['000001.SZ']) # å¢åŠ æ¿å—1çš„è‚¡ç¥¨åˆ—è¡¨

custom_sector('æ¿å—1', 'pop', ['000001.SZ']) # ç§»é™¤æ¿å—1çš„è‚¡ç¥¨

custom_sector('æ¿å—1', 'remove') # åˆ é™¤æ¿å—1
â€‹
```

## é€šç”¨æ•°æ®æ¥å£

### è¡Œæƒ…èµ„é‡‘æ•°æ®

#### è¡Œæƒ…æ•°æ®ï¼šget_price

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

```
get_price(
    securities,
    start_date=None,
    end_date='20180101',
    fre_step='1d',
    fields=None,
    skip_paused=False,
    fq='pre',
    bar_count=0,
    is_panel=False,
)
â€‹
```

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

securitiesï¼šstræˆ–list, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒåˆ†é’Ÿã€æ—¥

fre_step = 'xd'ï¼šxä¸ºæ­£æ•´æ•°ï¼Œä»£è¡¨xå¤©ï¼Œä¾‹å¦‚'1d'ä»£è¡¨1å¤©
fre_step = 'xm'ï¼šxä¸ºæ­£æ•´æ•°ï¼Œä»£è¡¨xåˆ†é’Ÿï¼Œä¾‹å¦‚'1m'ä»£è¡¨1åˆ†é’Ÿ

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œå¯å‚è€ƒ

æ—¥é¢‘ï¼šè‚¡ç¥¨æ—¥è¡Œæƒ…æ•°æ®(Aè‚¡)
åˆ†é’Ÿï¼šè‚¡ç¥¨åˆ†é’Ÿè¡Œæƒ…æ•°æ®(Aè‚¡)
å½“æ­¥é•¿ä¸ä¸º'1m'æˆ–'1d'æ—¶ï¼Œfieldsä»…æ”¯æŒ'open', 'close', 'high', 'low', 'volume', 'turnover'è¿™å‡ ä¸ªå­— æ®µ

skip_pausedï¼šboolï¼Œæ˜¯å¦è·³è¿‡åœç‰Œï¼Œé»˜è®¤ä¸ºä¸è·³è¿‡

fqï¼šstrï¼Œå¤æƒæ¨¡å¼

fq=None: ä¸å¤æƒ
fq='post': åå¤æƒ
fq='pre': åŠ¨æ€å‰å¤æƒ

bar_countï¼šintï¼Œå†å²é•¿åº¦ï¼Œbar_countä¸ä¸º0æ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®
å½“å–å•ä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œè¿”å›dataframe

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªè¯åˆ¸å¤šå±æ€§å†å²è¡Œæƒ…æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ”¯æŒè·å–å®æ—¶è¡Œæƒ…
è¯¥å‡½æ•°è¿˜æ”¯æŒæŸ¥è¯¢åœºå†…åŸºé‡‘ã€æŒ‡æ•°ã€å¯è½¬å€ºç­‰æ ‡çš„çš„è¡Œæƒ…æ•°æ®ï¼Œæ”¯æŒå­—æ®µå¯æŸ¥è¯¢SuperMindæ•°æ®å¹³å°
è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe
æš‚ä¸æ”¯æŒè·å–CSIç»“å°¾æŒ‡æ•°çš„å†å²åˆ†é’Ÿè¡Œæƒ…æ•°æ®

- ğŸ“ç¤ºä¾‹ï¼š

```
# è·å–å¹³å®‰é“¶è¡Œè‚¡ç¥¨, ä¸‡ç§‘A, è´µå·èŒ…å°2023å¹´2æœˆ1æ—¥å‰3å¤©çš„æ”¶ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·
value = get_price(['000001.SZ','000002.SZ','600519.SH'], None, '20230201', '1d', ['close', 'high', 'low'], True, None, 3, is_panel=1)
# æ‰“å°æ”¶ç›˜ä»·æ•°æ®
print(value['close'])
â€‹
```

- è¿”å›æ ¼å¼ï¼š

```
000001.SZ  000002.SZ  600519.SH
2023-01-30      15.15      18.09    1888.00
2023-01-31      14.99      18.29    1845.76
2023-02-01      14.70      18.19    1844.97
â€‹
```

#### å½“å‰barè¡Œæƒ…æ•°æ®ï¼šget_current

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

```
get_current(securities)
â€‹
```

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

securitiesï¼šstræˆ–list, æ ‡çš„ä»£ç 

- ğŸ”§ä½œç”¨ï¼š

è·å–è·å–å¤šåªè¯åˆ¸å½“å‰barçš„è¡Œæƒ…æ•°æ®ã€‚ä»…åœ¨ç­–ç•¥æ¡†æ¶å†…å¯ç”¨ã€‚

- â—æ³¨æ„äº‹é¡¹ï¼š

åœ¨ç ”ç©¶ç¯å¢ƒï¼Œä½¿ç”¨get_currentä»…æš‚æ—¶ä¸get_last_tickæ•ˆæœç­‰åŒï¼Œå¹¶æŠ¥é”™WARNæç¤ºæ›¿æ¢ã€‚å°†åœ¨ä¸‹ä¸€ç‰ˆæœ¬åºŸå¼ƒç ”ç©¶ç¯å¢ƒä¸­çš„get_currentï¼Œè¯·æ³¨æ„æ›¿æ¢ã€‚
è¿”å›æ•°æ®ç»“æ„ï¼Œå¯å‚è€ƒbar_dictæ•°æ®å¯¹è±¡

ğŸ“ç¤ºä¾‹ï¼š

```
log.info(get_current(['300033.SZ','600000.SH']))
â€‹
```

#### å¼€ç›˜ç«ä»·æˆäº¤ä¿¡æ¯ï¼šget_call_auction

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

get_call_auction(symbol, dt=None)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbolï¼šstr, æ ‡çš„ä»£ç 
dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

- ğŸ“ç¤ºä¾‹ï¼š

get_call_auction(['000001.SZ'],'20230613')
â€‹

- è¿”å›æ•°æ®ï¼š

price   turnover
symbol   
000001.SZ  11.76  3988992.0
â€‹

#### æœŸè´§è¡Œæƒ…æ•°æ®ï¼šget_price_future

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_price_future(
    symbol_list,
    start_date,
    end_date,
    fre_step,
    fields=None,
    bar_count=0,
    is_panel=0,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol_listï¼šstræˆ–list, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒåˆ†é’Ÿã€æ—¥

fre_step = 'xd'ï¼šxä¸ºæ­£æ•´æ•°ï¼Œä»£è¡¨xå¤©ï¼Œä¾‹å¦‚'1d'ä»£è¡¨1å¤©
fre_step = 'xm'ï¼šxä¸ºæ­£æ•´æ•°ï¼Œä»£è¡¨xåˆ†é’Ÿï¼Œä¾‹å¦‚'1m'ä»£è¡¨1åˆ†é’Ÿ

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œå¯å‚è€ƒ

æ—¥é¢‘ï¼šæœŸè´§æ—¥è¡Œæƒ…æ•°æ®(Aè‚¡)
åˆ†é’Ÿï¼šæœŸè´§åˆ†é’Ÿè¡Œæƒ…æ•°æ®(Aè‚¡)
å½“æ­¥é•¿ä¸ä¸º'1m'æˆ–'1d'æ—¶ï¼Œfieldsä»…æ”¯æŒ'open', 'close', 'high', 'low', 'volume', 'turnover'è¿™å‡ ä¸ªå­—æ®µ

bar_countï¼šintï¼Œå†å²é•¿åº¦ï¼Œbar_countä¸ä¸º0æ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®
å½“å–å•ä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œè¿”å›dataframe

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªæœŸè´§åˆçº¦å¤šå±æ€§å†å²è¡Œæƒ…æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ”¯æŒè·å–å®æ—¶è¡Œæƒ…
è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe

- ğŸ“ç¤ºä¾‹ï¼š
# è·å–IC2304ã€IF2304ä¸¤ä¸ªæ ‡çš„åœ¨2023å¹´4æœˆ6æ—¥å‰3å¤©çš„æ”¶ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·
value = get_price_future(
    symbol_list = ['IC2304','IF2304'],
    start_date = None,
    end_date = '20230406',
    fre_step = '1d',
    fields=['close', 'high', 'low'],
    bar_count = 3,
    is_panel = 1
)
# æ‰“å°æ”¶ç›˜ä»·æ•°æ®
print(value['close'])
â€‹

- è¿”å›æ•°æ®ï¼š
IC2304  IF2304
2023-04-03  6406.0  4091.2
2023-04-04  6415.0  4111.8
2023-04-06  6411.4  4098.0
â€‹

#### èœ¡çƒ›å›¾æ•°æ®ï¼šget_candle_stick

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_candle_stick(
    securities,
    end_date='20180101',
    fre_step='1d',
    fields=None,
    skip_paused=False,
    fq='pre',
    bar_count=0,
    is_panel=False,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

securitiesï¼šstræˆ–list, æ ‡çš„ä»£ç 

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒåˆ†é’Ÿã€æ—¥ã€å‘¨ã€æœˆã€å¹´

åˆ†é’Ÿï¼šæ”¯æŒ'1m','5m','15m','30m','60m'
æ—¥é¢‘ï¼šæ”¯æŒè‡ªå®šä¹‰å¤©æ•°ï¼Œ'nd'ï¼Œä¾‹å¦‚'2d'ä»£è¡¨2å¤©
å‘¨ï¼š'week'
æœˆï¼š'month'
å¹´ï¼š'year'

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œä»…æ”¯æŒ'open','high','low','close','volume','turnover'

skip_pausedï¼šboolï¼Œæ˜¯å¦è·³è¿‡åœç‰Œï¼Œé»˜è®¤ä¸ºä¸è·³è¿‡

fqï¼šstrï¼Œå¤æƒæ¨¡å¼

fq=None: ä¸å¤æƒ
fq='post': åå¤æƒ
fq='pre': åŠ¨æ€å‰å¤æƒ

bar_countï¼šintï¼Œå†å²é•¿åº¦ï¼Œbar_countä¸ä¸º0æ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®
å½“å–å•ä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œè¿”å›dataframe

- ğŸ”§ä½œç”¨ï¼š

è·å–è‚¡ç¥¨ã€å€ºåˆ¸ã€åŸºé‡‘çš„å†å²èœ¡çƒ›å›¾æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe

- ğŸ“ç¤ºä¾‹ï¼š
# è·å–600519.SHã€000002.SZä¸¤ä¸ªæ ‡çš„åœ¨2023å¹´8æœˆ1æ—¥å‰3ä¸ªæœˆçº¿çš„è¡Œæƒ…æ•°æ®
data = get_candle_stick(
    ['600519.SH','000002.SZ'], 
    end_date='20230801',
    fre_step='month',
    fields=['open', 'close', 'high', 'low', 'volume'],
    skip_paused=False,
    fq='pre',
    bar_count=3,
    is_panel=0
)
# æ‰“å°æ”¶ç›˜ä»·æ•°æ®
print(value['close'])
â€‹

- è¿”å›æ•°æ®ç¤ºä¾‹ï¼š

#### è·å–å®æ—¶è¡Œæƒ…å¿«ç…§æ•°æ®ï¼šget_last_tick

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

get_last_tick(securities, fields)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

securitiesï¼šstræˆ–list, æ ‡çš„ä»£ç 
fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œå¯å‚è€ƒå®æ—¶è¡Œæƒ…å¿«ç…§

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªè¯åˆ¸çš„å®æ—¶è¡Œæƒ…å¿«ç…§æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

- è·å–å½“æ—¥æ•°æ®æ—¶ï¼Œå“åº”æ—¶é—´è¶…è¿‡å…­ç§’ä¼šæŠ¥è¶…æ—¶é”™è¯¯

- ğŸ“ç¤ºä¾‹ï¼š

from mindgo_api import *
# è·å–å¹³å®‰é“¶è¡Œçš„æœ€æ–°ä»·
data = get_last_tick('000001.SZ',['current'])
print(data)
â€‹

#### è·å–å†å²è¡Œæƒ…å¿«ç…§æ•°æ®ï¼šget_tick

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

get_tick(securities, start_date, end_date, fields)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

securitiesï¼šstræˆ–list, æ ‡çš„ä»£ç 
start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´
end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´
fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œå¯å‚è€ƒå†å²è¡Œæƒ…å¿«ç…§

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªè¯åˆ¸çš„å†å²è¡Œæƒ…å¿«ç…§æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ä¹Ÿæ”¯æŒè·å–æ—¥å†…å¿«ç…§æ•°æ®
è·å–å½“æ—¥æ•°æ®æ—¶ï¼Œå“åº”æ—¶é—´è¶…è¿‡å…­ç§’ä¼šæŠ¥è¶…æ—¶é”™è¯¯

- ğŸ“ç¤ºä¾‹ï¼š

# è·å–å¹³å®‰é“¶è¡Œçš„2023å¹´8æœˆ1æ—¥9ç‚¹23åˆ†è‡³9ç‚¹30åˆ†çš„æˆäº¤ä»·
data = get_tick('000001.SZ','20230801 09:23','20230801 09:30',['current'])
print(data)
â€‹

#### ç»Ÿè®¡æ¶¨è·ŒåŒºé—´ä¸ªè‚¡æ•°é‡ï¼šget_stats

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

get_stats(date=None)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

dateï¼šstrï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œé»˜è®¤å½“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–æ¯æ—¥/å®æ—¶è¡Œæƒ…ä¸­å„ä¸ªæ¶¨è·ŒåŒºé—´çš„ä¸ªè‚¡æ•°é‡

- â—æ³¨æ„äº‹é¡¹ï¼š

ä¸€å…±æœ‰21ä¸ªæ¶¨è·Œå¹…åŒºé—´ï¼š (æ— ç©·å°,-9)ï¼Œ[-9,-8)...[-1,0),[0],(0,1]...(9,æ— ç©·å¤§)

- ğŸ“ç¤ºä¾‹ï¼š

# è·å–2023å¹´8æœˆ10æ—¥å…¨å¸‚åœºè‚¡ç¥¨çš„æ¶¨è·Œå¹…åŒºé—´
data = get_stats('20230810')
print(data)
â€‹

#### å‹åŠ›æ”¯æ’‘ä½æ•°æ®ï¼šget_resistance_support

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

get_resistance_support(
    symbol_list,
    start_date=None,
    end_date='20180101',
    fre_step='1d',
    fields=[],
    bar_count=0,
    is_panel=0,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol_listï¼šstræˆ–list, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒ'1d','30m','5m'ä¸‰ç§æ­¥é•¿

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µ

'resistance_line'ï¼šä»·æ ¼å‹åŠ›ä½(å…ƒ)
'support_line'ï¼šä»·æ ¼æ”¯æ’‘ä½(å…ƒ)

bar_countï¼šintï¼Œå†å²é•¿åº¦ï¼Œbar_countä¸ä¸º0æ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®
å½“å–å•ä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œè¿”å›dataframe

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªè¯åˆ¸è‚¡ä»·å‹åŠ›ä½ã€æ”¯æ’‘ä½æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe

- ğŸ“ç¤ºä¾‹ï¼š

# 000001.SZåœ¨2023å¹´8æœˆ1æ—¥è‡³2023å¹´8æœˆ10æ—¥é˜»åŠ›çº¿çš„æ—¥æ•°æ®ï¼Œå­—å…¸å½¢å¼è¾“å‡º
data = get_resistance_support(
    symbol_list='000001.SZ',
    start_date='20230801',
    end_date='20230810',
    fre_step='1d',
    fields=['resistance_line'],
    bar_count=None,
    is_panel=0
)
print(data)
â€‹

#### è·å–åŸºé‡‘å‡€å€¼æ•°æ®ï¼šget_extras

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_extras(
    security_list,
    start_date=None,
    end_date='20180101',
    fields=None,
    count=None,
    is_panel=False,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

security_listï¼šlist, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒ'1d','30m','5m'ä¸‰ç§æ­¥é•¿

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µ

'unit_net_value'ï¼šå•ä½å‡€å€¼(å…ƒ/ä»½)
'acc_net_value'ï¼šç´¯è®¡å‡€å€¼(å…ƒ/ä»½)
'pre_net_value'ï¼šå¤æƒå‡€å€¼(å…ƒ/ä»½)

countï¼šintï¼Œå†å²é•¿åº¦ï¼Œcountä¸ä¸º Noneæ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®

- ğŸ”§ä½œç”¨ï¼š

è·å–å¤šåªåŸºé‡‘çš„å‡€å€¼æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe

- ğŸ“ç¤ºä¾‹ï¼š
# æ²ªæ·±300ETFã€ä¸­è¯500ETFåœ¨2023å¹´8æœˆ1æ—¥è‡³2023å¹´8æœˆ10æ—¥å•ä½å‡€å€¼ã€ç´¯è®¡å‡€å€¼ã€å¤æƒå‡€å€¼
data = get_extras(['510300.OF', '510500.OF'], '20230801', '20230805', ['unit_net_value','acc_net_value','pre_net_value'])
print(data)
â€‹

#### èèµ„èåˆ¸æ•°æ®ï¼šget_mtss

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_mtss(
    security_list,
    start_date=None,
    end_date='20180101',
    fields=None,
    count=None,
    is_panel=False,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

security_listï¼šlist, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µ

'fin_value'ï¼šèèµ„ä½™é¢(å…ƒ)
'fin_buy_value'ï¼šèèµ„ä¹°å…¥é¢(å…ƒ)
'fin_refund_value'ï¼šèèµ„å¿è¿˜é¢(å…ƒ)
'sec_value'ï¼šèåˆ¸ä½™é¢(å…ƒ)
'sec_sell_value'ï¼šèåˆ¸å–å‡ºé¢(å…ƒ)
'sec_refund_value'ï¼šèåˆ¸å¿è¿˜é¢(å…ƒ)
'fin_sec_value'ï¼šèèµ„èåˆ¸ä½™é¢(å…ƒ)

countï¼šintï¼Œå†å²é•¿åº¦ï¼Œcountä¸ä¸º Noneæ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®

- ğŸ”§ä½œç”¨ï¼š

è·å–è‚¡ç¥¨çš„å†å²èèµ„èåˆ¸æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe
ä»…æ”¯æŒæ—¥é¢‘

- ğŸ“ç¤ºä¾‹ï¼š
#è·å–å¹³å®‰é“¶è¡Œ2023å¹´8æœˆ1æ—¥è¿‡å»20å¤©çš„èèµ„ä½™é¢ä¸èåˆ¸ä½™é¢æ•°æ®
data =get_mtss(['000001.SZ'], None, '20230801', ['fin_value', 'sec_value'], 20, is_panel=0)
print(data)
â€‹

#### è·å–å†å²èµ„é‡‘æ•°æ®ï¼šget_money_flow_step

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_money_flow_step(
    security_list,
    start_date=None,
    end_date='20180101',
    fre_step='1d',
    fields=None,
    count=None,
    is_panel=False,
)
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

security_listï¼šlist, æ ‡çš„ä»£ç 

start_dateï¼šstr,int,float,datetime-likeï¼Œèµ·å§‹æ—¶é—´ï¼Œä¸èƒ½å’Œbar_countå…±å­˜

end_dateï¼šstr,int,float,datetime-likeï¼Œç»“æŸæ—¶é—´

fre_stepï¼šstrï¼Œæ—¶é—´æ­¥é•¿ï¼Œæ”¯æŒ'1d','30m','5m'ä¸‰ç§æ­¥é•¿

fieldsï¼šlistï¼Œéœ€è¦è·å–çš„å­—æ®µï¼Œå¯å‚è€ƒèµ„é‡‘æµå‘æ•°æ®

countï¼šintï¼Œå†å²é•¿åº¦ï¼Œcountä¸ä¸º Noneæ—¶ start_dateå¿…é¡»ä¸º None

is_panelï¼šboolï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼Œé»˜è®¤ä¸ºFalse

å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Falseæ—¶ï¼Œè¿”å›keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºdataframeçš„å­—å…¸
å½“å–å¤šä¸ªæ ‡çš„è¡Œæƒ…æ•°æ®æ—¶ï¼Œis_panel=Trueæ—¶ï¼Œè¿”å›panelæ ¼å¼æ•°æ®

- ğŸ”§ä½œç”¨ï¼š

è·å–è‚¡ç¥¨çš„å†å²èµ„é‡‘æµå‘æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

è¿”å›panelæ ¼å¼æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨to_frame()æ–¹æ³•å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰mutilindexçš„äºŒç»´dataframe

å¤§å•ã€ä¸­å•ã€å°å•çš„æ ‡å‡†å¦‚ä¸‹ï¼š

A.ä¸Šè¯Aè‚¡ã€æ·±è¯ä¸»æ¿å¤§å•æ ‡å‡†ï¼š

           ç±»å‹       è‚¡æ•°                      é‡‘é¢                 å æµé€šç›˜æ¯”
           å°å•       1ä¸‡è‚¡ä»¥ä¸‹         æˆ–     5ä¸‡å…ƒä»¥ä¸‹
           ä¸­å•       1ä¸‡è‚¡åˆ°6ä¸‡è‚¡       æˆ–     5ä¸‡å…ƒâ€”30ä¸‡å…ƒ
           å¤§å•       6ä¸‡è‚¡åˆ°20ä¸‡è‚¡      æˆ–     30ä¸‡å…ƒâ€”100ä¸‡å…ƒ          æˆ–    0.1%
           ç‰¹å¤§å•      20ä¸‡è‚¡ä»¥ä¸Š        æˆ–     100ä¸‡å…ƒä»¥ä¸Š
    B.ä¸­å°æ¿ã€åˆ›ä¸šæ¿å¤§å•æ ‡å‡†ï¼š

            ç±»å‹       é‡‘é¢
            å°å•       5ä¸‡å…ƒä»¥ä¸‹
            ä¸­å•       5ä¸‡å…ƒâ€”20ä¸‡å…ƒ(åŒ…æ‹¬5ä¸‡ï¼Œä¸åŒ…æ‹¬20ä¸‡)
            å¤§å•       20ä¸‡å…ƒâ€”50ä¸‡å…ƒ(åŒ…æ‹¬20ä¸‡ï¼Œä¸åŒ…æ‹¬50ä¸‡)
            ç‰¹å¤§å•      50ä¸‡å…ƒä»¥ä¸Š
â€‹

- ğŸ“ç¤ºä¾‹ï¼š
#è·å–å¹³å®‰é“¶è¡Œ2023å¹´8æœˆ1æ—¥è‡³2023å¹´8æœˆ10æ—¥çš„æ—¥é¢‘ä¸»åŠ¨ä¹°å…¥å¤§å•æ•°æ®
data = get_money_flow_step(
    security_list=['000001.SZ'],
    start_date='20230801',
    end_date='20230810',
    fre_step='1d',
    fields=['act_buy_xl'],
    count=None,
    is_panel=0
)
print(data)
â€‹

### è¯åˆ¸ä¿¡æ¯æ•°æ®

#### è·å–å•åªè¯åˆ¸çš„åŸºæœ¬ä¿¡æ¯ï¼šget_security_info

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_security_info(symbol)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbolï¼šstrï¼Œè‚¡ç¥¨ã€æœŸè´§ã€åŸºé‡‘ã€æŒ‡æ•°ç­‰è¯åˆ¸æ ‡çš„å¯¹åº”çš„åŒèŠ±é¡ºä»£ç 

- ğŸ”§ä½œç”¨ï¼š

è·å–å•åªè¯åˆ¸çš„åŸºæœ¬ä¿¡æ¯

- â—æ³¨æ„äº‹é¡¹ï¼š

symboléœ€è¦æ»¡è¶³åŒèŠ±é¡ºçš„æ ¼å¼ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸å–åˆ°æ•°æ®
è¯¥å‡½æ•°è·å–çš„æ ‡çš„ç®€ç§°åœ¨å›æµ‹ä¸­ä¸å¯ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºSTè‚¡

- ğŸ“ç¤ºä¾‹ï¼š

data = get_security_info('000001.SZ')
print(data)
â€‹

#### è·å–æ‰€æœ‰è¯åˆ¸ä¿¡æ¯ï¼šget_all_securities

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_all_securities(ty=None, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

tyï¼šstrï¼Œè¯åˆ¸ç±»å‹ï¼Œé»˜è®¤å–æ‰€æœ‰è¯åˆ¸ç±»å‹

ty='stock'ï¼šAè‚¡
ty='hstock'ï¼šæ¸¯è‚¡
ty='ustock'ï¼šç¾è‚¡
ty='index'ï¼šæŒ‡æ•°
ty='etf'ï¼šETFåŸºé‡‘
ty='lof'ï¼šLOFåŸºé‡‘
ty='fja'ï¼šåˆ†çº§AåŸºé‡‘
ty='fjb'ï¼šåˆ†çº§BåŸºé‡‘
ty='qdii'ï¼šqdiiåŸºé‡‘
ty='ota'ï¼šåœºå¤–åŸºé‡‘
ty='fund'ï¼šèµ„äº§æ”¯æŒè¯åˆ¸
ty='futures'ï¼šé‡‘èæœŸè´§
ty='commodity_futures'ï¼šå•†å“æœŸè´§
ty='bond_futures'ï¼šå›½å€ºæœŸè´§
ty='option'ï¼šETFæœŸæƒ
ty='cbond'ï¼šAè‚¡å¯è½¬å€º
ty='forex'ï¼šå¤–æ±‡ï¼ˆä¸­å›½é“¶è¡ŒåŒå‘å®ï¼‰åˆçº¦
ty='metal'ï¼šT+Då»¶æœŸäº¤æ”¶åˆçº¦

date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–å•åªè¯åˆ¸çš„åŸºæœ¬ä¿¡æ¯

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°è·å–çš„æ ‡çš„ç®€ç§°åœ¨å›æµ‹ä¸­ä¸å¯ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºSTè‚¡

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥å¤„äºä¸Šå¸‚çŠ¶æ€çš„æ²ªäº¬æ·±è‚¡ç¥¨ä¿¡æ¯
data = get_all_securities('stock','20230801')
print(data)
â€‹

#### è·å–æœŸè´§æœŸæƒå“ç§ç›¸å…³ä¿¡æ¯ï¼šget_futures_info

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_futures_info(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbolï¼šstrï¼ŒæœŸè´§å“ç§ç±»å‹
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–æœŸè´§å“ç§ç›¸å…³ä¿¡æ¯

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢èºçº¹é’¢æœŸè´§çš„2023å¹´8æœˆ1æ—¥çš„å“ç§ä¿¡æ¯
data = get_futures_info('RB','20230801')
print(data)
â€‹

#### è·å–ä¸»åŠ›åˆçº¦ä»£ç ï¼šget_futures_dominate

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_futures_dominate(symbol, date=None, seq=0)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼ŒæœŸè´§åˆçº¦å“ç§ï¼Œä¾‹å¦‚æ²ªæ·±300è‚¡æŒ‡æœŸè´§ä¸º'IF'
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥
seq: intï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸»åŠ›åˆçº¦ï¼Œä¸º1è¡¨ç¤ºæ¬¡ä¸»åŠ›åˆçº¦ï¼Œä¾æ¬¡æŒ‰åºåˆ—æ¨ï¼Œè¶…å‡ºåºåˆ—è¿”å›None

- ğŸ”§ä½œç”¨ï¼š

è·å–æŸä¸ªæ—¥æœŸçš„æŸä¸ªå“ç§çš„ä¸»åŠ›åˆçº¦ä»£ç ï¼Œä»¥ä¸»åŠ›æŒä»“æ¥åˆ’åˆ†ï¼Œè¯¥å“ç§æŒä»“é‡è¿ç»­ä¸‰æ—¥æœ€å¤§ä¸”ä¸ºè¿œ
æœŸåˆçº¦æ—¶ï¼Œä¸»åŠ›åˆçº¦ä¼šè¿›è¡Œåˆ‡æ¢

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥çš„èºçº¹é’¢æœŸè´§ä¸»åŠ›åˆçº¦
data =get_futures_dominate('RB','20230801')
print(data)
â€‹

#### è·å–æŒ‡å®šå“ç§æ‰€æœ‰å¯äº¤æ˜“çš„åˆçº¦ï¼šget_future_code

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_futures_dominate(underlying_symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

underlying_symbol: strï¼ŒæœŸè´§åˆçº¦å“ç§ï¼Œä¾‹å¦‚æ²ªæ·±300è‚¡æŒ‡æœŸè´§ä¸º'IF'
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–å½“å‰æœŸè´§å“ç§æ‰€æœ‰å¯äº¤æ˜“çš„æœŸè´§åˆçº¦

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥å¯äº¤æ˜“çš„èºçº¹é’¢æœŸè´§åˆçº¦
future_code_all=get_future_code('RB','20230801)
print(future_code_all)
â€‹

#### è·å–å¯äº¤æ˜“çš„æœŸæƒåˆçº¦åˆ—è¡¨ï¼šget_option_code

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_option_code(date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–å½“å‰æ‰€æœ‰å¯äº¤æ˜“çš„æ²ªæ·±äº¤æ˜“æ‰€ETFæœŸæƒåˆçº¦

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥å¯äº¤æ˜“çš„èºçº¹é’¢æœŸè´§åˆçº¦
options_all = get_option_code('20230801')
print(options_all)
â€‹

#### è·å–æŒ‡æ•°æˆä»½è‚¡ï¼šget_index_stocks

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_index_stocks(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼ŒæŒ‡æ•°ä»£ç 
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–æŒ‡æ•°å¯¹åº”çš„æˆåˆ†è‚¡è‚¡ç¥¨ä»£ç åˆ—è¡¨

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°è‹¥åœ¨æ¨¡æ‹Ÿäº¤æ˜“çš„initå‡½æ•°ä¸­ä½¿ç”¨,åˆ™å¿…é¡»å¡«å†™dateå‚æ•°

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥ä¸Šè¯50æˆåˆ†è‚¡
stock_list= get_index_stocks('000016.SH','20230801')
print(stock_list)
â€‹

#### è·å–æŒ‡æ•°æˆä»½è‚¡æƒé‡ï¼šget_index_weight

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_index_weight(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼ŒæŒ‡æ•°ä»£ç 
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–æŒ‡æ•°å¯¹åº”çš„æˆåˆ†è‚¡æƒé‡æ•°æ®

- â—æ³¨æ„äº‹é¡¹ï¼š

éƒ¨åˆ†ç­‰æƒæŒ‡æ•°ä¼šè¿”å›ç©ºçš„dataframeï¼Œä¾‹å¦‚åŒèŠ±é¡ºæŒ‡æ•°
è¯¥å‡½æ•°è‹¥åœ¨æ¨¡æ‹Ÿäº¤æ˜“çš„initå‡½æ•°ä¸­ä½¿ç”¨,åˆ™å¿…é¡»å¡«å†™dateå‚æ•°

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥ä¸Šè¯50æˆåˆ†è‚¡æƒé‡
weight = get_index_weight('000016.SH','20230801')
print(weight)
â€‹

#### è·å–æŒ‡æ•°åˆ—è¡¨ï¼šget_index_list

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_index_list(suffix, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

suffix: strï¼ŒæŒ‡æ•°ä»£ç åç¼€
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·Ÿæ®æŒ‡æ•°ä»£ç åç¼€æŸ¥è¯¢æŒ‡æ•°

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥åç¼€ä¸º'TI'çš„æŒ‡æ•°åˆ—è¡¨(åŒèŠ±é¡ºæŒ‡æ•°)
index_list = get_index_list('TI','20230801')
print(index_list)
â€‹

#### è·å–è¡Œä¸šæˆä»½è‚¡ï¼šget_industry_stocks

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_industry_stocks(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼Œè¡Œä¸šæŒ‡æ•°ä»£ç 
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–è¡Œä¸šå¯¹åº”çš„æˆåˆ†è‚¡è‚¡ç¥¨ä»£ç åˆ—è¡¨

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥ä¸­ä¿¡äºŒçº§è¡Œä¸š-ä¸€èˆ¬é›¶å”®çš„æˆåˆ†è‚¡åˆ—è¡¨
index_list = get_industry_stocks('CI311000','20230801')
print(index_list)
â€‹

#### è·å–è¡Œä¸šåˆ†ç±»ä¿¡æ¯ï¼šget_industry_relate

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_industry_relate(date='now', types='industryid1', fields=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
typesï¼šè¡Œä¸šåˆ†ç±»ç±»å‹ï¼Œæ”¯æŒåŒèŠ±é¡ºè¡Œä¸šåˆ†ç±»ã€ç”³ä¸‡è¡Œä¸šåˆ†ç±»ã€ä¸­ä¿¡è¡Œä¸šåˆ†ç±»ã€è¯ç›‘ä¼šè¡Œä¸šåˆ†ç±»ï¼Œå¯åœ¨SuperMindæ•°æ®å¹³å°ä¸­æŸ¥è¯¢
fieldsï¼šå­—æ®µåï¼Œå¯ä»¥å‚è€ƒè¡Œä¸šåˆ†ç±»ä¿¡æ¯å­—æ®µ

- ğŸ”§ä½œç”¨ï¼š

è·å–Aè‚¡è¡Œä¸šåˆ†ç±»ä¿¡æ¯ï¼Œå¯æŸ¥åˆ°è¡Œä¸šåˆ†ç±»åŠå¯¹åº”ä»£ç 

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥ä¸­ä¿¡äºŒçº§è¡Œä¸šåˆ†ç±»ä¿¡æ¯
industry_info = get_industry_relate(date='20230801',types='ci_industryid2')
print(industry_info)
â€‹

#### è·å–è‚¡ç¥¨æ‰€å±è¡Œä¸šæ•°æ®ï¼šget_symbol_industry

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_symbol_industry(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼Œè‚¡ç¥¨ä»£ç 
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´

- ğŸ”§ä½œç”¨ï¼š

è·å–ä¸ªè‚¡çš„è¡Œä¸šåˆ†ç±»ä¿¡æ¯ï¼Œæ”¯æŒåŒèŠ±é¡ºè¡Œä¸šåˆ†ç±»ã€ç”³ä¸‡è¡Œä¸šåˆ†ç±»ã€ä¸­ä¿¡è¡Œä¸šåˆ†ç±»ã€è¯ç›‘ä¼šè¡Œä¸šåˆ†ç±»ã€æ ‡æ™®è¡Œä¸šåˆ†ç±»

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢300033.SZ(åŒèŠ±é¡º)åœ¨2023å¹´8æœˆ1æ—¥çš„è¡Œä¸šåˆ†ç±»ä¿¡æ¯
industry_info = get_symbol_industry('300033.SZ',date='20230801')
print(industry_info)
â€‹

#### è·å–æ‰€æœ‰åŒèŠ±é¡ºæ¦‚å¿µæˆåˆ†è‚¡ï¼šget_concept_stocks

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_concept_stocks(symbol, date=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

symbol: strï¼Œæ¦‚å¿µä»£ç æˆ–è€…æ¦‚å¿µæŒ‡æ•°ä»£ç 
date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œå›æµ‹æ—¶é»˜è®¤ä¸ºå½“å‰å›æµ‹æ—¶é—´çš„å‰ä¸€äº¤æ˜“æ—¥ï¼Œç ”ç©¶ç¯å¢ƒä¸­é»˜è®¤ä¸ºå‰ä¸€äº¤æ˜“æ—¥

- ğŸ”§ä½œç”¨ï¼š

è·å–æ¦‚å¿µä¸‹çš„æˆåˆ†è‚¡

- â—æ³¨æ„äº‹é¡¹ï¼š

é€šå¸¸åœ¨åŒèŠ±é¡ºè¡Œæƒ…è½¯ä»¶ä¸Šèƒ½çœ‹åˆ°è¡Œæƒ…çš„éƒ½æ˜¯æ¦‚å¿µæŒ‡æ•°ï¼Œä»£ç ä»¥TIç»“å°¾
æ¦‚å¿µä¸ä¸€å®šæœ‰å¯¹åº”çš„æ¦‚å¿µæŒ‡æ•°
æ¦‚å¿µæŒ‡æ•°çš„æˆåˆ†è‚¡ä¹Ÿå¯ä»¥é€šè¿‡ get_index_stockså‡½æ•°è·å–

- ğŸ“ç¤ºä¾‹ï¼š

#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥ChatGPTæ¦‚å¿µçš„æˆåˆ†è‚¡
stock_list = get_concept_stocks('886031.TI',date='20230801')
print(stock_list)
â€‹

#### è·å–æ‰€æœ‰åŒèŠ±é¡ºæ¦‚å¿µä¿¡æ¯ï¼šget_concept_relate

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_concept_relate(date='now', levels=None, fields=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

date: strï¼ŒæŸ¥è¯¢æ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
levels: stræˆ–listï¼Œæ¦‚å¿µç±»å‹ï¼Œé»˜è®¤å–æ‰€æœ‰æ¦‚å¿µ
fields: listï¼Œéœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼Œé»˜è®¤è¿”å›æ‰€æœ‰å­—æ®µ

- ğŸ”§ä½œç”¨ï¼š

è·å–æ‰€æœ‰åŒèŠ±é¡ºæ¦‚å¿µåˆ†ç±»ä¿¡æ¯åŠå¯¹åº”çš„æŒ‡æ•°ä»£ç 

- â—æ³¨æ„äº‹é¡¹ï¼š

é€šå¸¸åœ¨åŒèŠ±é¡ºè¡Œæƒ…è½¯ä»¶ä¸Šèƒ½çœ‹åˆ°è¡Œæƒ…çš„éƒ½æ˜¯æ¦‚å¿µæŒ‡æ•°ï¼Œä»£ç ä»¥TIç»“å°¾
æ¦‚å¿µä¸ä¸€å®šæœ‰å¯¹åº”çš„æ¦‚å¿µæŒ‡æ•°

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥æ‰€æœ‰åŒèŠ±é¡ºæ¦‚å¿µä¿¡æ¯
concept_info = get_concept_relate(date = '20230801')
print(concept_info)
â€‹

#### è·å–æŒ‡å®šæ—¶é—´æ®µäº¤æ˜“æ—¥ï¼šget_trade_days

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_trade_days(start_date=None, end_date='20180101', count=None)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

start_date: str,int,datetime_likeï¼Œèµ·å§‹æ—¥æœŸï¼Œé»˜è®¤ä¸ºNone
end_date: str,int,datetime_likeï¼Œç»“æŸæ—¥æœŸï¼Œé»˜è®¤ä¸º'20180101'
count: intï¼Œäº¤æ˜“æ—¥æ•°é‡

- ğŸ”§ä½œç”¨ï¼š

è·å–æ²ªæ·±äº¬äº¤æ˜“æ‰€æŒ‡å®šæ—¶é—´æ®µäº¤æ˜“æ—¥

- â—æ³¨æ„äº‹é¡¹ï¼š

å½“start_dateã€end_dateå…¨éƒ¨ä¸ä¸ºNoneæ—¶ï¼Œcountå‚æ•°ä¸ç”Ÿæ•ˆ

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢2023å¹´1æœˆ1æ—¥è‡³2023å¹´8æœˆ1æ—¥ä¹‹é—´çš„äº¤æ˜“æ—¥
tdays_list = get_trade_days('20230101','20230801')
print(tdays_list)
â€‹

#### è·å–æ‰€æœ‰äº¤æ˜“æ—¥ï¼šget_all_trade_days

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_all_trade_days()

- ğŸ”§ä½œç”¨ï¼š

è·å–æ²ªæ·±äº¬äº¤æ˜“æ‰€æ‰€æœ‰äº¤æ˜“æ—¥

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°ä¸éœ€è¦å¡«å†™å‚æ•°

- ğŸ“ç¤ºä¾‹ï¼š
#æŸ¥è¯¢æ‰€æœ‰äº¤æ˜“æ—¥
tdays_list = get_all_trade_days()
print(tdays_list)
â€‹

#### è·å–å› å­æ•°æ®ï¼šget_sfactor_data

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_sfactor_data(start_date, end_date, stocks, factor_names)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

start_date: str,int,datetime_likeï¼Œèµ·å§‹æ—¥æœŸ
end_date: str,int,datetime_likeï¼Œç»“æŸæ—¥æœŸ
stocksï¼šlistï¼Œè‚¡ç¥¨æ± 
factor_namesï¼šlistï¼Œå› å­æ± 

æŠ€æœ¯æŒ‡æ ‡ç±»å› å­
è´¢åŠ¡æŒ‡æ ‡ç±»å› å­

- ğŸ”§ä½œç”¨ï¼š

è·å–å› å­æ•°æ®ï¼ˆå·²åšæ•°æ®å¤„ç†ï¼šå»æå€¼ã€æ ‡å‡†åŒ–ï¼‰

- â—æ³¨æ„äº‹é¡¹ï¼š

æ­¤å‡½æ•°æ”¯æŒè·å–è‡ªå®šä¹‰å› å­

- ğŸ“ç¤ºä¾‹ï¼š

#è·å–300033.SZï¼ˆåŒèŠ±é¡ºï¼‰å’Œ600519.SHï¼ˆè´µå·èŒ…å°ï¼‰2023å¹´8æœˆ1æ—¥åˆ°2023å¹´8æœˆ5æ—¥çš„macdå› å­æ•°æ®
start_date = '20230801'
end_date = '20230805'
stocks=['600519.SH','300033.SZ']
factor_input = ['macd']
factor_info = get_sfactor_data(start_date, end_date, stocks, factor_input)
â€‹

### è¡¨æ•°æ®

#### è¡¨æ•°æ®å¯¹è±¡ï¼šquery

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
query(table)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

table:æ•°æ®è¡¨å¯¹è±¡ï¼Œæ”¯æŒçš„æ•°æ®å¯åœ¨SuperMindæ•°æ®å¹³å°ä¸­æŸ¥è¯¢

- ğŸ”§ä½œç”¨ï¼š

æ„é€ queryå¯¹è±¡ï¼Œä¼ å…¥éœ€è¦å–æ•°çš„ä¿¡æ¯

- ğŸš€ï¸ä½¿ç”¨æ–¹æ³•ï¼š

ä»…å–æŸå­—æ®µï¼šæœ‰æ—¶å€™ä¸éœ€è¦æŠŠæ•´å¼ è¡¨å–å‡ºï¼Œä»…ä»…æƒ³å–è¡¨ä¸­çš„æŸå‡ ä¸ªå­—æ®µ

#åªå–concept_classificationè¡¨çš„symbolã€dateã€conceptä¸‰ä¸ªå­—æ®µ
q = query(
    concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
    concept_classification.date,
    concept_classification.concept
)
â€‹

filteræ“ä½œï¼šè®¾ç½®æ¡ä»¶ï¼Œç›¸å½“äºSQLä¸­çš„whereæ–¹æ³•

#åªå–concept_classificationè¡¨çš„symbolã€dateã€conceptä¸‰ä¸ªå­—æ®µï¼Œå¹¶åªå–åŒèŠ±é¡º2023å¹´2æœˆ1æ—¥ä¹‹åçš„æ•°æ®
q = query(
    concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
    concept_classification.date,
    concept_classification.concept
).filter(
    concept_classification.symbol=='300033.SZ',
    concept_classification.date>'20230201'
)
â€‹
#åªå–concept_classificationè¡¨çš„symbolã€dateã€conceptä¸‰ä¸ªå­—æ®µï¼Œå¹¶å–åŒèŠ±é¡ºã€è´µå·èŒ…å°åœ¨2023å¹´2æœˆ1æ—¥å½“å¤©çš„æ•°æ®
q = query(
    concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
    concept_classification.date,
    concept_classification.concept
).filter(
    concept_classification.symbol.in_(['300033.SZ','600519.SH']),
    concept_classification.date=='20230201'
)
â€‹

limitæ“ä½œï¼šæŒ‡å®šæŸ¥è¯¢å‰nè¡Œæ•°æ®

#åªå–concept_classificationè¡¨çš„symbolã€dateã€conceptä¸‰ä¸ªå­—æ®µçš„å‰10è¡Œ
q = query(
    concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
    concept_classification.date,
    concept_classification.concept
).limit(10)
â€‹

order_byæ“ä½œï¼šæŒ‡å®šä¸€åˆ—æ•°æ®è¿›è¡Œæ’åº

#åªå–concept_classificationè¡¨çš„symbolã€dateã€conceptï¼Œå¹¶è·Ÿæ®dateé™åºæ’åˆ—
q = query(
    concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
    concept_classification.date,
    concept_classification.concept
).order_by(
    concept_classification.date.desc()
)
â€‹

- â—æ³¨æ„äº‹é¡¹ï¼š

order_byä»å¤§åˆ°å°æ’åºåˆ™ä½¿ç”¨ï¼š.desc(),ä»å°åˆ°å¤§æ’åºåˆ™ä½¿ç”¨ï¼š.aes()
æ›´å¤šè¯¦ç»†ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒsqlalchemyå®˜æ–¹æ–‡æ¡£
æ„é€ å®Œqueryå¯¹è±¡åéœ€è¦ç”¨ run_queryæˆ–è€… get_fundamentalså–æ•°

#### å–è¡¨æ•°æ®ï¼šrun_query

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
run_query(query_object)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

query_object:queryå¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•å¯å‚è€ƒqueryå¯¹è±¡æ–‡æ¡£

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢å‡½æ•°ï¼Œå¯æŸ¥è¯¢é™¤è´¢åŠ¡æ•°æ®è¡¨ä»¥å¤–çš„æ‰€æœ‰æ•°æ®è¡¨

- â—æ³¨æ„äº‹é¡¹ï¼š

è´¢åŠ¡æ•°æ®è¡¨ä¸æ”¯æŒä½¿ç”¨æ­¤å‡½æ•°æŸ¥è¯¢
æ”¯æŒçš„æ•°æ®å¯åœ¨SuperMindæ•°æ®å¹³å°ä¸­æŸ¥è¯¢

- ğŸ“ç¤ºä¾‹ï¼š

```
#è·å–300033.SZï¼ˆåŒèŠ±é¡ºï¼‰å’Œ600519.SHï¼ˆè´µå·èŒ…å°ï¼‰2023å¹´2æœˆ1æ—¥çš„æ¦‚å¿µæ•°æ®
data = run_query(
    query(
        concept_classification.symbol,#æ ¼å¼ä¸ºï¼šè¡¨å.å­—æ®µ
        concept_classification.date,
        concept_classification.concept
    ).filter(
        concept_classification.symbol.in_(['300033.SZ','600519.SH']),
        concept_classification.date=='20230201'
    )
)
â€‹
```

#### å–è´¢åŠ¡è¡¨æ•°æ®ï¼šget_fundamentals

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_fundamentals(query_object, date=None, statDate=None, latest=False)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

query_object:queryå¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•å¯å‚è€ƒqueryå¯¹è±¡æ–‡æ¡£

- ğŸ”§ä½œç”¨ï¼š

æŸ¥è¯¢å‡½æ•°ï¼Œå¯æŸ¥è¯¢è´¢åŠ¡æ•°æ®è¡¨

- â—æ³¨æ„äº‹é¡¹ï¼š

æ­¤å‡½æ•°ä»…æ”¯æŒæŸ¥è¯¢è´¢åŠ¡æ•°æ®è¡¨
dateå’ŒstatDateå‚æ•°ä¼ å…¶ä¸­ä¹‹ä¸€å³å¯
dateå’ŒstatDateå…¨ä¸ºNoneæ—¶ï¼Œdateé»˜è®¤å–å½“å‰æ—¶é—´çš„å‰ä¸€æ—¥
æ”¯æŒçš„æ•°æ®å¯åœ¨SuperMindæ•°æ®å¹³å°ä¸­æŸ¥è¯¢

- ğŸ“ç¤ºä¾‹ï¼š

```
#æŸ¥è¯¢2023å¹´8æœˆ1æ—¥çš„æ€»å¸‚å€¼æ•°æ®ï¼Œå¹¶é™åºæ’åˆ—
data = get_fundamentals(
    query(
        valuation.symbol,
        valuation.market_cap
    ).order_by(
        valuation.market_cap.desc()
    ),
    date = '20230810'
)
print(data.head())
â€‹
```

## é—®è´¢æ¥å£

### é—®è´¢æ¥å£ä½¿ç”¨å‰å¿…è¯»

é—®è´¢é€‰è‚¡æ¥å£å› ä¸ºä»–çš„ä¾¿åˆ©å’Œé€Ÿåº¦è€Œå¹¿å—å–œæ¬¢ã€‚

ç„¶è€Œé—®è´¢çš„è¯ç”Ÿä¹‹åˆæ˜¯ç”¨äºå®æ—¶é€‰è‚¡ï¼Œè€Œéå›æµ‹ã€‚æ‰€ä»¥åœ¨å›æµ‹çš„åœºæ™¯å¿…ç„¶ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚è¿™äº›é—®é¢˜è§£å†³éœ€è¦æ—¶é—´å’Œç²¾åŠ›ï¼Œå¦‚æœä½ å‘ç°é—®é¢˜è®°å¾—åŠæ—¶åé¦ˆç»™supermindå®˜æ–¹ã€‚æˆ‘ä»¬ä¼šæŒç»­æ¨åŠ¨è§£å†³ã€‚

å»ºè®®ç”¨é—®è´¢æ¥å¿«é€ŸéªŒè¯æƒ³æ³•ï¼Œç„¶åè‡ªå·±ç”¨pyhtonå®ç°ä»£ç æ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚

query_iwencai å’Œ get_iwencai çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºäºŒè€…è°ƒç”¨çš„æœåŠ¡æ˜¯ä¸ä¸€æ ·çš„ï¼šquery_iwencaiï¼ŒåŸºäºié—®è´¢æ™ºèƒ½æŠ•é¡¾ï¼Œä¸»è¦ç”¨äºå®æ—¶é€‰è‚¡ï¼Œæ³¨æ„ï¼Œç›®å‰iwencaiåˆ†ä¸º2å¥—ï¼ŒAPIè¿”å›ç»“æœä¸æ—§ç‰ˆæ˜¯ä¸€è‡´çš„ï¼›get_iwencaiåŸºäºBackTest é‡åŒ–ç­–ç•¥å¹³å° (10jqka.com.cn)ï¼Œä¸»è¦ç”¨äºå†å²å›æµ‹ï¼Œget_iwencai ä¸ºäº†é¿å…ä¸€äº›æœªæ¥å‡½æ•°ï¼Œä¼šå†å›æµ‹ç¯å¢ƒå¯¹æŸäº›è¯­å¥ä¸å¯ç”¨ï¼Œä¼šå‡ºç°iwencaiåˆå§‹åŒ–å¤±è´¥çš„æç¤ºã€‚

è‡ªç„¶è¯­è¨€è§£æè¾ƒä¸ºå¤æ‚ï¼Œæœ€å¥½å…ˆåˆ°å¯¹åº”çš„é—®è´¢ç½‘ç«™å¯¹é—®å¥è¿›è¡Œè¯•éªŒï¼Œç¡®è®¤è§£æç»“æœæ²¡æœ‰é—®é¢˜ä¹‹åï¼Œå†åº”ç”¨åˆ°ç­–ç•¥å½“ä¸­ã€‚

### é—®è´¢å®æ—¶æ•°æ®ï¼šquery_iwencai (ç ”ç©¶ç¯å¢ƒä½¿ç”¨ï¼Œä¸ç½‘é¡µä½¿ç”¨ä¸€è‡´)

- ğŸ“¢ ä»‹ç»
ié—®è´¢åŒèŠ±é¡ºæ——ä¸‹çš„AIæŠ•é¡¾å¹³å°ï¼Œæ˜¯è´¢ç»é¢†åŸŸè½åœ°æœ€ä¸ºæˆåŠŸçš„è‡ªç„¶è¯­è¨€ã€è¯­éŸ³é—®ç­”ç³»ç»Ÿã€‚

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
query_iwencai(query,domain='è‚¡ç¥¨',timeout=6,df=True)

ç ”ç©¶ç¯å¢ƒåœ°å€ï¼šhttps://quant.10jqka.com.cn/view/study-research.html

ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯å†…è®¿é—®ï¼šé‡åŒ–-ç ”ç©¶ç¯å¢ƒ

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | æ ¼å¼ | è¯´æ˜ |
| --- | --- | --- |
| query | str | è‡ªç„¶è¯­å¥ï¼Œè¯­å¥è§„èŒƒå¯å‚è€ƒié—®è´¢å®˜æ–¹ç½‘ç«™ |
| domain | str | å¯é€‰'è‚¡ç¥¨'ã€'åŸºé‡‘'ã€'æŒ‡æ•°'ã€'æ–°ä¸‰æ¿'ã€'æ¸¯è‚¡'ã€'ç¾è‚¡' |
| timeout | int | è¶…æ—¶æ—¶é—´ |
| df | bool | æ ¼å¼åŒ–dataframe |

- ğŸ”§ä½œç”¨ï¼š

query_iwencaiå‡½æ•°æ˜¯æ™ºèƒ½é€‰è‚¡å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œæ‰§è¡Œé€‰è‚¡å¹¶è·å–è‚¡ç¥¨åˆ—è¡¨

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°å¯è·å¾—å’Œç½‘é¡µç‰ˆé—®è´¢ç›¸åŒçš„ç»“æœ
è¯¥å‡½æ•°æ”¯æŒé—®è´¢ä¸“ä¸šç‰ˆçš„é—®å¥
è¯¥å‡½æ•°æœ‰è°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼Œæ¯15åˆ†é’Ÿå†…é™åˆ¶è°ƒç”¨5000æ¬¡
è¯¥å‡½æ•°ä¸æ˜¯ä¸ºå›æµ‹è€Œè®¾è®¡ï¼Œå›æµ‹ä¸­æ…ç”¨

- ğŸ“ç¤ºä¾‹ï¼š

query_iwencai("è¿‘10æ—¥çš„åŒºé—´ä¸»åŠ›èµ„é‡‘æµå‘>5000ä¸‡å…ƒï¼Œå¸‚å€¼>1000äº¿ï¼Œæ—¥æˆäº¤é¢>30äº¿")
â€‹

### é—®è´¢æ˜¨æ—¥æ•°æ®ï¼šget_iwencai(å›æµ‹ç¯å¢ƒä½¿ç”¨)

- ğŸ“¢ä»‹ç»
backtestæ˜¯åŒèŠ±é¡ºié—®è´¢æ¨å‡ºçš„ç­–ç•¥å›æµ‹æœåŠ¡ï¼Œå¯ä»¥åŸºäºè‡ªç„¶è¯­è¨€å¿«é€Ÿé€‰å‡ºæ¯å¤©ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨æ± 

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š
get_iwencai(sentence, set_attr, version)

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | æ ¼å¼ | è¯´æ˜ |
| --- | --- | --- |
| sentence | str | è‡ªç„¶è¯­å¥ï¼Œè¯­å¥è§„èŒƒå¯å‚è€ƒbacktest |
| set_attr | str | å¦‚æœè¯¥å‚æ•°ä¸è¾“å…¥,åˆ™è¿”å›çš„è‚¡ç¥¨åˆ—è¡¨é»˜è®¤ä¿å­˜åœ¨context.iwencai_securitiesä¸­ |
| å¦‚æœè¯¥å‚æ•°è¾“å…¥'stocks_list'(è‡ªå®šä¹‰),åˆ™è¿”å›çš„è‚¡ç¥¨åˆ—è¡¨ä¿å­˜åœ¨context.stocks_listä¸­ |  |  |
| version | str | 'stable':ç¨³å®šç‰ˆ'online':ä¸ºæ­£å¼ç‰ˆå¤‡æ³¨ï¼šå¦‚æœæ‚¨å¸Œæœ›è·Ÿé—®è´¢å®˜ç½‘ä¿æŒä¸€è‡´ï¼Œè¯·ä½¿ç”¨'online' |

- ğŸ”§ä½œç”¨ï¼š

get_iwencaiå‡½æ•°æ˜¯æ™ºèƒ½é€‰è‚¡å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œæ‰§è¡Œé€‰è‚¡å¹¶è·å–è‚¡ç¥¨åˆ—è¡¨(ä»…å¯åœ¨è‚¡ç¥¨APIç­–ç•¥æ¡†æ¶çš„åˆå§‹åŒ–å‡½æ•°ä¸­è°ƒç”¨)

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°æ˜¯æ™ºèƒ½é€‰è‚¡å‡½æ•°,å±äºåˆå§‹åŒ–å‡½æ•°ï¼Œå¿…é¡»åœ¨initå‡½æ•°ä¸‹è®¾ç½®,å¦åˆ™æ— æ•ˆ
è¯¥å‡½æ•°è®¾ç½®åœ¨initå‡½æ•°ä¸‹æ—¶ï¼Œç³»ç»Ÿä¼šä¿å­˜è¯¥è¯­å¥ï¼Œå¹¶ä½¿å¾—è¯¥å‡½æ•°èƒ½æ¯å¤©æ‰§è¡Œé€‰è‚¡ï¼Œå°†ç»“æœä¿å­˜è‡³contextå¯¹è±¡ä¸­
è¯¥å‡½æ•°çš„set_attrå‚æ•°ä¸è¾“å…¥, åˆ™ä¼šå°†è¿”å›çš„è‚¡ç¥¨åˆ—è¡¨é»˜è®¤ä¿å­˜åœ¨context.iwencai_securitiesä¸­
get_iwencaiçš„é€‰è‚¡ç»“æœä¸ä¼šç›´æ¥è¾“å‡º,è¿”å›å€¼ä¸ºç©º
è¯¥å‡½æ•°æœ‰è°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼Œæ¯15åˆ†é’Ÿå†…é™åˆ¶è°ƒç”¨5000æ¬¡

- ğŸ“ç¤ºä¾‹ä¸€ï¼š

def init(context):
    # è¾“å…¥é€‰è‚¡æ¡ä»¶
    get_iwencai('å‡€åˆ©æ¶¦å¢é•¿å¤§äº20%,è‚¡ä»·ä½äº20æ—¥å‡çº¿ä¸Šæ–¹')

def handle_bar(context, bar_dict):
    # æ‰“å°è¾“å›æµ‹å‡ºå‰ä¸€æ—¥æ”¶ç›˜åçš„é€‰è‚¡ç»“æœ
    log.info(context.iwencai_securities)
â€‹

- ğŸ“ç¤ºä¾‹äºŒï¼š

# ç ”ç©¶ç¯å¢ƒä¸­ä½¿ç”¨get_iwencai
get_iwencai = get_iwencai = get_open_api('public').get_iwencai
stk_pool = get_iwencai('å‡€åˆ©æ¶¦å¢é•¿å¤§äº20%,è‚¡ä»·ä½äº20æ—¥å‡çº¿ä¸Šæ–¹','20230701','20230801',version='stable')
â€‹

### é—®è´¢æ¥å£æ˜¯å¦æ”¯æŒæœ¬åœ°æ¥å£è°ƒç”¨ï¼Ÿ

ä¸æ”¯æŒã€‚supermind ä¸­åªæœ‰æå°‘çš„æ•°æ®æ”¯æŒæœ¬åœ°æ¥å£è°ƒç”¨ï¼Œè¯¦è§ï¼šhttps://quant.10jqka.com.cn/view/help/3

### å¸‚é¢ZUIå…¨ï¼ä¸€æ–‡è®²é€é—®è´¢è¯­å¥æ·±åº¦ä½¿ç”¨æŠ€å·§ï¼ˆå«50ä¸ªæ¡ˆä¾‹ï¼‰

https://quant.10jqka.com.cn/view/article/2183

## ç»„åˆä¼˜åŒ–å™¨

### æ„é€ ç»„åˆä¼˜åŒ–

#### åˆå§‹åŒ–ç»„åˆä¼˜åŒ–å™¨

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

OptimizePort(stock_return, trade_date, return_expect, opt_focus='UI', benchmark='000905.SH', loss_aversion=0.5, cost=0.003, period='d', holds=0, long_short='long-only')
â€‹

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

stock_returnï¼šè‚¡ç¥¨é¢„æœŸæ”¶ç›Šç‡ï¼Œæ”¯æŒpd.Seriesæˆ–dictæ ¼å¼

pd.Seriesæ ¼å¼ï¼šindexè¡¨ç¤ºè‚¡ç¥¨ä»£ç ï¼Œvaluesä¸ºé¢„æœŸæ”¶ç›Šç‡
dictæ ¼å¼ï¼škeyè¡¨ç¤ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºé¢„æœŸæ”¶ç›Šç‡

trade_dateï¼šstrï¼Œè¡¨ç¤ºä¼˜åŒ–æ—¥æœŸï¼Œä¾‹å¦‚'2022-12-14'
return_expectï¼š boolï¼Œé¢„æœŸæ”¶ç›Šè®¡ç®—æ–¹å¼

return_expect = Trueï¼šé‡‡ç”¨ä¸ªè‚¡å†å²å¹³å‡å€¼ä½œä¸ºé¢„æœŸæ”¶ç›Šç‡
return_expect = Falseï¼šæŒ‰stock_returnä½œä¸ºé¢„æœŸæ”¶ç›Šç‡

opt_focusï¼šstr,ä¼˜åŒ–æ–¹å¼

opt_focus='UI'ï¼šæ•ˆç”¨æœ€å¤§åŒ–ï¼Œé»˜è®¤
opt_focus='IR'ï¼šä¸ºæœ€å¤§ä¿¡æ¯æ¯”ç‡
opt_focus='MVO'ï¼šä¸ºå¤æ™®æ¯”ç‡

benchmarkï¼šstrï¼ŒåŸºå‡†æŒ‡æ•°ï¼Œç›®å‰ä»…æ”¯æŒ'000905.SH' (é»˜è®¤)ï¼Œ'000300.SH' ã€ '000016.SH' ã€'000906.SH'ã€'000010.SH' ã€'000001.SH'
loss_aversionï¼šfloatï¼Œé£é™©åŒæ¶ç³»æ•°ï¼Œé»˜è®¤ä¸º0.5
costï¼šfloatï¼Œäº¤æ˜“æˆæœ¬ï¼Œé»˜è®¤ä¸º0.003
periodï¼šstrï¼Œè°ƒä»“å‘¨æœŸ

period='d'ï¼šæŒ‰å¤©è°ƒä»“
period='w'ï¼šæŒ‰å‘¨è°ƒä»“
period='m'ï¼šæŒ‰æœˆè°ƒä»“

holds:å½“å‰æŒä»“æƒé‡ï¼Œæ”¯æŒpd.Seriesæˆ–dictæ ¼å¼

pd.Seriesæ ¼å¼ï¼šindexè¡¨ç¤ºè‚¡ç¥¨ä»£ç ï¼Œvaluesä¸ºæŒä»“æƒé‡
dictæ ¼å¼ï¼škeyè¡¨ç¤ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºæŒä»“æƒé‡
int(0)ï¼šä»£è¡¨æ²¡æœ‰æŒä»“(é»˜è®¤)

long_shortï¼šstrï¼Œè¡¨ç¤ºæ˜¯å¦åšç©º

long_short='long-only'ï¼šåªèƒ½åšå¤š
long_short='short-long'ï¼šå¯ä»¥åšå¤šä¹Ÿå¯ä»¥åšç©º

- ğŸ”§ä½œç”¨ï¼š

ç”¨æ¥æ„é€ ç»„åˆä¼˜åŒ–å™¨

- â—æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åœ¨ç­–ç•¥æ¡†æ¶å‡½æ•°ä¹‹å¤–æ‰§è¡Œ
æ€§èƒ½åˆ†æç»“æœå†æ—¥å¿—çš„æœ€åéƒ¨åˆ†æ˜¾ç¤º
func_listå‚æ•°å¦‚æœä¸å¡«å†™ï¼Œåˆ™é»˜è®¤ä¸ºåˆ†ææ‰€æœ‰å‡½æ•°

#### æ·»åŠ çº¦æŸæ¡ä»¶

- ğŸ‘‘è°ƒç”¨æ–¹æ³•ï¼š

```
opt.add_constraint(con_type, args=())
â€‹
```

- ğŸ“šå‚æ•°è¯´æ˜ï¼š

stock_returnï¼šstrï¼Œçº¦æŸç±»å‹

stock_return='turnover_target'ï¼šæ¢æ‰‹ç‡çº¦æŸ
stock_return='tracking_error'ï¼šè·Ÿè¸ªè¯¯å·®çº¦æŸ
stock_return='port_risk'ï¼šç»„åˆé£é™©çº¦æŸ
stock_return='stock_weight'ï¼šä¸ªè‚¡æƒé‡çº¦æŸ
stock_return='special_style'ï¼šé£æ ¼å› å­æš´éœ²åº¦çº¦æŸ
stock_return='industry'ï¼šè¡Œä¸šå› å­æš´éœ²åº¦çº¦æŸ

argsï¼šä¸åŒçº¦æŸç±»å‹ä¼ çš„å‚æ•°ä¸åŒ

stock_return='turnover_target'ï¼šè¾“å…¥tuple(æ¢æ‰‹ç‡ä¸Šé™ï¼Œæ¢æ‰‹ç‡ä¸‹é™)ï¼Œé»˜è®¤ä¸º(0.0, 100.0)ï¼Œ100è¡¨ç¤º100%
stock_return='tracking_error'ï¼šè¾“å…¥tuple(è·Ÿè¸ªè¯¯å·®ä¸‹é™ï¼Œè·Ÿè¸ªè¯¯å·®ä¸Šé™)ï¼Œé»˜è®¤ä¸º(0.0, inf)
stock_return='port_risk'ï¼šè¾“å…¥tuple(ç»„åˆé£é™©ä¸‹é™ï¼Œç»„åˆé£é™©ä¸Šé™)ã€‚é»˜è®¤ä¸º(0.0, inf)
stock_return='stock_weight'ï¼šè¾“å…¥pd.Seriesæˆ–dict. keyä¸ºè‚¡ç¥¨ä»£ç ï¼Œvalueä¸ºæƒé‡
stock_return='special_style'ï¼šè¾“å…¥dictï¼Œä¸”keyä¸ºå› å­åï¼Œvalueä¸ºlist: [æš´éœ²åº¦ä¸‹é™ï¼Œæš´éœ²åº¦ä¸Šé™]ï¼Œè¯¥çº¦æŸæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¿…é¡»ä¼ å‚æ•°ï¼Œä¾‹å¦‚{'size':[0,0.5]}
stock_return='industry'ï¼šè¾“å…¥stræˆ–dict. å½“ä¸ºsträ¸”ä¸º'industry_neutralize'æ—¶æ‰€æœ‰è¡Œä¸šä¸‹é™ä¸º0ï¼Œä¸Šé™ä¸º0.1;å¦åˆ™keyä¸ºè¡Œä¸šä»£ç ï¼Œvalueä¸ºlist:[æš´éœ²åº¦ä¸‹é™ï¼Œæš´éœ²åº¦ä¸Šé™]ï¼Œè¯¥çº¦æŸæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¿…é¡»ä¼ å‚æ•°ï¼Œä¾‹å¦‚{'ci4000000':[0.0, 0.5]}

ğŸ”§ä½œç”¨ï¼š

- é€šè¿‡çº¦æŸç±»å‹æ¥æ·»åŠ çº¦æŸæ¡ä»¶

â—æ³¨æ„äº‹é¡¹ï¼š

- å¯åŒæ—¶æ·»åŠ å¤šç§çº¦æŸ

#### ç»„åˆä¼˜åŒ–å™¨åº”ç”¨ç¤ºä¾‹

```
# ä»ä¸­è¯500ä¸­éšæœºé€‰å–50è‚¡ç¥¨ï¼Œæ¨¡æ‹Ÿä¸­è¯500èµ°åŠ¿ï¼Œå‘¨é¢‘è°ƒä»“
# Stratified Sampling æ–¹æ³•ä¼˜ç‚¹ï¼š
#1.å½“æŒ‡æ•°æ ‡çš„è¿‡å¤šæ—¶ï¼Œå®Œå…¨å¤åˆ¶çš„èµ„é‡‘é‡è¦æ±‚è¾ƒé«˜
#2.æŒ‡æ•°æ ‡çš„ä¸­å¾ˆå¤šè‚¡ç¥¨çš„æˆäº¤é‡è¿‡å°ï¼Œäº¤æ˜“æˆæœ¬è¾ƒé«˜ï¼Œç”šè‡³æ— æ³•å®Œå…¨å¤åˆ¶ä¸­è¯500æ ‡çš„æˆåˆ†è‚¡æƒé‡
import random
def init(context):
    # è®¾ç½®åŸºå‡†æ”¶ç›Šï¼šä¸­è¯500æŒ‡æ•°
    set_benchmark('000905.SH')
    # æ‰“å°æ—¥å¿—
    log.info('ç­–ç•¥å¼€å§‹è¿è¡Œ,åˆå§‹åŒ–å‡½æ•°å…¨å±€åªè¿è¡Œä¸€æ¬¡')
    # è®¾ç½®è‚¡ç¥¨æ¯ç¬”äº¤æ˜“çš„æ‰‹ç»­è´¹ä¸ºä¸‡åˆ†ä¹‹äºŒ(æ‰‹ç»­è´¹åœ¨ä¹°å–æˆäº¤åæ‰£é™¤,ä¸åŒ…æ‹¬ç¨è´¹,ç¨è´¹åœ¨å–å‡ºæˆäº¤åæ‰£é™¤)
    set_commission(PerShare(type='stock',cost=0.0002))
    # è®¾ç½®è‚¡ç¥¨äº¤æ˜“æ»‘ç‚¹0.5%,è¡¨ç¤ºä¹°å…¥ä»·ä¸ºå®é™…ä»·æ ¼ä¹˜1.005,å–å‡ºä»·ä¸ºå®é™…ä»·æ ¼ä¹˜0.995
    set_slippage(PriceSlippage(0.002))
    # è®¾ç½®æ—¥çº§æœ€å¤§æˆäº¤æ¯”ä¾‹25%,åˆ†é’Ÿçº§æœ€å¤§æˆäº¤æ¯”ä¾‹50%
    # æ—¥é¢‘è¿è¡Œæ—¶ï¼Œä¸‹å•æ•°é‡è¶…è¿‡å½“å¤©çœŸå®æˆäº¤é‡25%,åˆ™å…¨éƒ¨ä¸æˆäº¤
    # åˆ†é’Ÿé¢‘è¿è¡Œæ—¶ï¼Œä¸‹å•æ•°é‡è¶…è¿‡å½“å‰åˆ†é’ŸçœŸå®æˆäº¤é‡50%,åˆ™å…¨éƒ¨ä¸æˆäº¤
    set_volume_limit(0.25,0.5)
    # ä»ä¸­è¯500ä¸­éšæœºé€‰å–50è‚¡ç¥¨
    stocks=random.sample(list(get_index_stocks('000905.SH','2017-12-21')), 50)
    #æ„å»ºè‚¡ç¥¨åˆ—è¡¨ï¼Œå½¢å¼ä¸ºdictï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ç»„åˆä¼˜åŒ–å™¨
    context.security={ia:0 for ia in stocks} 
    #æ„å»ºåˆå§‹è‚¡ç¥¨æƒé‡
    context.hold={ia:0 for ia in stocks}
    #è‚¡ç¥¨æƒé‡é™åˆ¶
    context.weight={ia :[0.0,100.0] for ia in stocks}
    #å‘¨é¢‘è°ƒä»“
    run_weekly(func=optmize, date_rule=1, reference_security='000001.SZ')

def optmize(context, bar_dict):
    time=get_datetime().strftime('%Y%m%d')
    #æ„é€ ç»„åˆä¼˜åŒ–å™¨ï¼Œä¼˜åŒ–ç›®æ ‡è®¾ç½®ä¸ºæœ€å¤§åŒ–æ•ˆç”¨ï¼Œä½¿ç”¨å†å²æ”¶ç›Šç‡ä½œä¸ºé¢„æœŸæ”¶ç›Šç‡
    opt=OptimizePort(context.security, '2017-12-21', True, opt_focus='UI', benchmark='000905.SH', period='w', holds=context.hold, long_short='long-only')
    opt.add_constraint('stock_weight',context.weight)
    #æ·»åŠ è·Ÿè¸ªè¯¯å·®çº¦æŸ
    opt.add_constraint('tracking_error',(-0.02,0.02))
    # opt.add_constraint('industry','industry_neutralize')
    #ä½¿ç”¨ç»„åˆä¼˜åŒ–å™¨è¿›è¡Œæ±‚è§£
    stock_weight = opt.optimized_weight()
    #æ ¹æ®ç»„åˆä¼˜åŒ–å™¨ç»“æœè¿›è¡Œæƒé‡è°ƒæ•´
    for ia in stock_weight.keys():
        order_target_percent(ia, stock_weight[ia]/100)
â€‹
```

## å®˜æ–¹äº¤æµç¾¤

### æ³¨æ„æ­¤ç¾¤ä¸ºäº¤æµç¾¤ï¼Œå¦‚æœæœ‰ç–‘é—®è¯·åœ¨è®ºå›å‘å¸– ï¼Œç‚¹æ­¤å‘å¸–

ğŸŒåŠ å…¥SuperMindå®˜æ–¹å¾®ä¿¡ç¾¤äº¤æµ

ä¸Šä¸€èŠ‚ä¸‹ä¸€èŠ‚
éœ€è¦å¸®åŠ©ï¼Ÿè¯•è¯•AIå°åŠ©æ‰‹å§